
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ai/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.5">
    
    
      
        <title>ORM - Elibrary</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6a10b989.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-orm-tutorial-django-sqlalchemy-raw-sql" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Elibrary" class="md-header__button md-logo" aria-label="Elibrary" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Elibrary
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ORM
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Elibrary" class="md-nav__button md-logo" aria-label="Elibrary" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Elibrary
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Classes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/classes/classes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/classes/data_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/classes/descriptors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descriptors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/classes/iterators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iterators
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/context_managers/context_managers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Context Managers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Types
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Data Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/data_types/data_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/data_types/dic_set/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dict & Set
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/data_types/list_tuple/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    List & Tuple
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/data_types/object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Object
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/decorators/decorators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decorators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/modules/builtins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Builtins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/modules/io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/modules/modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Structure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Structure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/structure/code_design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/structure/dessign_patterns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Design Patterns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/structure/practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/structure/solid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SOLID
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/structure/structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Structure
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Async
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Async
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/async/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    asyncio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../python/testing/pytest_fixtures.py" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Postgres
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Postgres
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../postgresql/tricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perfomance tricks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    GitLab
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            GitLab
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gitlab/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/deployments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/image-security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Image Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/lifecycle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lifecycle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/maintanence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maintenance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/namespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Namespaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/newtwork/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/pods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pods
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/replicasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReplicaSets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/roles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/sheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scheduler
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Programming
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Programming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../code_review/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Review
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ORM
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ORM
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-filtering-records-with-conditional-logic" class="md-nav__link">
    1. Filtering Records with Conditional Logic
  </a>
  
    <nav class="md-nav" aria-label="1. Filtering Records with Conditional Logic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-aggregating-data" class="md-nav__link">
    2. Aggregating Data
  </a>
  
    <nav class="md-nav" aria-label="2. Aggregating Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_1" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_1" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_1" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-joining-tables" class="md-nav__link">
    3. Joining Tables
  </a>
  
    <nav class="md-nav" aria-label="3. Joining Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_2" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_2" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_2" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-grouping-records" class="md-nav__link">
    4. Grouping Records
  </a>
  
    <nav class="md-nav" aria-label="4. Grouping Records">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_3" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_3" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_3" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-complex-subqueries" class="md-nav__link">
    5. Complex Subqueries
  </a>
  
    <nav class="md-nav" aria-label="5. Complex Subqueries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_4" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_4" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_4" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-limiting-and-offsetting-results" class="md-nav__link">
    6. Limiting and Offsetting Results
  </a>
  
    <nav class="md-nav" aria-label="6. Limiting and Offsetting Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_5" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_5" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_5" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-transactions" class="md-nav__link">
    7. Transactions
  </a>
  
    <nav class="md-nav" aria-label="7. Transactions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_6" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_6" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_6" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-custom-fields-expressions" class="md-nav__link">
    8. Custom Fields &amp; Expressions
  </a>
  
    <nav class="md-nav" aria-label="8. Custom Fields & Expressions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_7" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_7" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_7" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-case-and-conditional-expressions" class="md-nav__link">
    9. Case and Conditional Expressions
  </a>
  
    <nav class="md-nav" aria-label="9. Case and Conditional Expressions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_8" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_8" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_8" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-raw-sql-in-orm" class="md-nav__link">
    10. Raw SQL in ORM
  </a>
  
    <nav class="md-nav" aria-label="10. Raw SQL in ORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_9" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_9" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_9" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-filtering-records-with-conditional-logic" class="md-nav__link">
    1. Filtering Records with Conditional Logic
  </a>
  
    <nav class="md-nav" aria-label="1. Filtering Records with Conditional Logic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-aggregating-data" class="md-nav__link">
    2. Aggregating Data
  </a>
  
    <nav class="md-nav" aria-label="2. Aggregating Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_1" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_1" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_1" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-joining-tables" class="md-nav__link">
    3. Joining Tables
  </a>
  
    <nav class="md-nav" aria-label="3. Joining Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_2" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_2" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_2" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-grouping-records" class="md-nav__link">
    4. Grouping Records
  </a>
  
    <nav class="md-nav" aria-label="4. Grouping Records">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_3" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_3" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_3" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-complex-subqueries" class="md-nav__link">
    5. Complex Subqueries
  </a>
  
    <nav class="md-nav" aria-label="5. Complex Subqueries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_4" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_4" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_4" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-limiting-and-offsetting-results" class="md-nav__link">
    6. Limiting and Offsetting Results
  </a>
  
    <nav class="md-nav" aria-label="6. Limiting and Offsetting Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_5" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_5" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_5" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-transactions" class="md-nav__link">
    7. Transactions
  </a>
  
    <nav class="md-nav" aria-label="7. Transactions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_6" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_6" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_6" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-custom-fields-expressions" class="md-nav__link">
    8. Custom Fields &amp; Expressions
  </a>
  
    <nav class="md-nav" aria-label="8. Custom Fields & Expressions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_7" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_7" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_7" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-case-and-conditional-expressions" class="md-nav__link">
    9. Case and Conditional Expressions
  </a>
  
    <nav class="md-nav" aria-label="9. Case and Conditional Expressions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_8" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_8" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_8" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-raw-sql-in-orm" class="md-nav__link">
    10. Raw SQL in ORM
  </a>
  
    <nav class="md-nav" aria-label="10. Raw SQL in ORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#django-orm_9" class="md-nav__link">
    Django ORM:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sqlalchemy_9" class="md-nav__link">
    SQLAlchemy:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql_9" class="md-nav__link">
    Raw SQL:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="advanced-orm-tutorial-django-sqlalchemy-raw-sql">Advanced ORM Tutorial: Django, SQLAlchemy &amp; Raw SQL</h1>
<h2 id="1-filtering-records-with-conditional-logic">1. Filtering Records with Conditional Logic</h2>
<h3 id="django-orm">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>from django.models import Q
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>YourModel.objects.filter(Q(field1=&quot;value1&quot;) | Q(field2=&quot;value2&quot;))
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>from sqlalchemy import or_
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>session.query(YourModel).filter(or_(YourModel.field1 == &#39;value1&#39;, YourModel.field2 == &#39;value2&#39;))
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>SELECT * FROM your_model WHERE field1 = &#39;value1&#39; OR field2 = &#39;value2&#39;;
</code></pre></div></td></tr></table></div>
<h2 id="2-aggregating-data">2. Aggregating Data</h2>
<h3 id="django-orm_1">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>from django.db.models import Sum
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>YourModel.objects.aggregate(Sum(&#39;field1&#39;))
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_1">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>from sqlalchemy import func
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>session.query(func.sum(YourModel.field1)).scalar()
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_1">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>SELECT SUM(field1) FROM your_model;
</code></pre></div></td></tr></table></div>
<h2 id="3-joining-tables">3. Joining Tables</h2>
<h3 id="django-orm_2">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>YourModel.objects.select_related(&#39;related_model&#39;)
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_2">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>session.query(YourModel, RelatedModel).join(RelatedModel)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_2">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>SELECT * FROM your_model JOIN related_model ON your_model.related_id = related_model.id;
</code></pre></div></td></tr></table></div>
<h2 id="4-grouping-records">4. Grouping Records</h2>
<h3 id="django-orm_3">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>from django.db.models import Count
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>YourModel.objects.values(&#39;field1&#39;).annotate(Count(&#39;field2&#39;))
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_3">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>from sqlalchemy import func
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>session.query(YourModel.field1, func.count(YourModel.field2)).group_by(YourModel.field1)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_3">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a>SELECT field1, COUNT(field2) FROM your_model GROUP BY field1;
</code></pre></div></td></tr></table></div>
<h2 id="5-complex-subqueries">5. Complex Subqueries</h2>
<h3 id="django-orm_4">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a>subquery = YourModel.objects.filter(field1=&quot;value1&quot;).values(&#39;field2&#39;)
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>result = OtherModel.objects.filter(field3__in=subquery)
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_4">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a>subquery = session.query(YourModel.field2).filter(YourModel.field1 == &#39;value1&#39;).subquery()
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>result = session.query(OtherModel).filter(OtherModel.field3.in_(subquery))
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_4">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a>SELECT * FROM other_model WHERE field3 IN (SELECT field2 FROM your_model WHERE field1 = &#39;value1&#39;);
</code></pre></div></td></tr></table></div>
<h2 id="6-limiting-and-offsetting-results">6. Limiting and Offsetting Results</h2>
<h3 id="django-orm_5">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a>YourModel.objects.all()[5:10]
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_5">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a>session.query(YourModel).limit(5).offset(5)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_5">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a>SELECT * FROM your_model LIMIT 5 OFFSET 5;
</code></pre></div></td></tr></table></div>
<h2 id="7-transactions">7. Transactions</h2>
<h3 id="django-orm_6">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a>from django.db import transaction
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>with transaction.atomic():
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>    YourModel.objects.create(field1=&quot;value1&quot;)
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>    YourModel.objects.create(field1=&quot;value2&quot;)
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_6">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a>with session.begin():
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>    new_record1 = YourModel(field1=&quot;value1&quot;)
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>    new_record2 = YourModel(field1=&quot;value2&quot;)
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>    session.add(new_record1)
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>    session.add(new_record2)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_6">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span>
<span class="normal"><a href="#__codelineno-20-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a>BEGIN;
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>INSERT INTO your_model (field1) VALUES (&#39;value1&#39;);
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>INSERT INTO your_model (field1) VALUES (&#39;value2&#39;);
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>COMMIT;
</code></pre></div></td></tr></table></div>
<h2 id="8-custom-fields-expressions">8. Custom Fields &amp; Expressions</h2>
<h3 id="django-orm_7">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a>from django.db.models import F, ExpressionWrapper, IntegerField
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>YourModel.objects.annotate(new_field=ExpressionWrapper(F(&#39;field1&#39;) + F(&#39;field2&#39;), output_field=IntegerField()))
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_7">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a>from sqlalchemy import func
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>session.query(YourModel, (YourModel.field1 + YourModel.field2).label(&#39;new_field&#39;))
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_7">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a>SELECT *, (field1 + field2) AS new_field FROM your_model;
</code></pre></div></td></tr></table></div>
<h2 id="9-case-and-conditional-expressions">9. Case and Conditional Expressions</h2>
<h3 id="django-orm_8">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span>
<span class="normal"><a href="#__codelineno-24-4">4</a></span>
<span class="normal"><a href="#__codelineno-24-5">5</a></span>
<span class="normal"><a href="#__codelineno-24-6">6</a></span>
<span class="normal"><a href="#__codelineno-24-7">7</a></span>
<span class="normal"><a href="#__codelineno-24-8">8</a></span>
<span class="normal"><a href="#__codelineno-24-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>from django.db.models import Case, When, Value, CharField
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>YourModel.objects.annotate(
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>    field_status=Case(
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>        When(field1=&quot;value1&quot;, then=Value(&#39;status1&#39;)),
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>        When(field1=&quot;value2&quot;, then=Value(&#39;status2&#39;)),
<a id="__codelineno-24-6" name="__codelineno-24-6"></a>        default=Value(&#39;unknown&#39;),
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>        output_field=CharField()
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>    )
<a id="__codelineno-24-9" name="__codelineno-24-9"></a>)
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_8">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span>
<span class="normal"><a href="#__codelineno-25-6">6</a></span>
<span class="normal"><a href="#__codelineno-25-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a>from sqlalchemy.sql.expression import case
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>session.query(YourModel,
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>    case([
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>        (YourModel.field1 == &quot;value1&quot;, &quot;status1&quot;),
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>        (YourModel.field1 == &quot;value2&quot;, &quot;status2&quot;),
<a id="__codelineno-25-6" name="__codelineno-25-6"></a>    ], else_=&quot;unknown&quot;).label(&#39;field_status&#39;)
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_8">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span>
<span class="normal"><a href="#__codelineno-26-6">6</a></span>
<span class="normal"><a href="#__codelineno-26-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a>SELECT *,
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>    CASE
<a id="__codelineno-26-3" name="__codelineno-26-3"></a>        WHEN field1 = &#39;value1&#39; THEN &#39;status1&#39;
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>        WHEN field1 = &#39;value2&#39; THEN &#39;status2&#39;
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>        ELSE &#39;unknown&#39;
<a id="__codelineno-26-6" name="__codelineno-26-6"></a>    END AS field_status
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>FROM your_model;
</code></pre></div></td></tr></table></div>
<h2 id="10-raw-sql-in-orm">10. Raw SQL in ORM</h2>
<h3 id="django-orm_9">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a>YourModel.objects.raw(&#39;SELECT * FROM your_model WHERE field1 = %s&#39;, [&#39;value1&#39;])
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_9">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a>session.query(YourModel).from_statement(&quot;SELECT * FROM your_model WHERE field1 = :value&quot;).params(value=&quot;value1&quot;)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_9">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a>SELECT * FROM your_model WHERE field1 = &#39;value1&#39;;
</code></pre></div></td></tr></table></div>
<h1 id="advanced-orm-optimization-techniques-django-sqlalchemy-raw-sql">Advanced ORM Optimization Techniques: Django, SQLAlchemy &amp; Raw SQL</h1>
<h2 id="1-avoiding-n1-queries-problem">1. Avoiding <code>n+1</code> Queries Problem</h2>
<h3 id="django-orm_10">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a># Using select_related for ForeignKey and OneToOneField relations
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>YourModel.objects.select_related(&#39;related_model&#39;).all()
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a># Using prefetch_related for ManyToManyField and reverse ForeignKey relations
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>YourModel.objects.prefetch_related(&#39;related_model_set&#39;).all()
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_10">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a># Using joinedload for JOINed loading
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>from sqlalchemy.orm import joinedload
<a id="__codelineno-31-3" name="__codelineno-31-3"></a>session.query(YourModel).options(joinedload(YourModel.related_model))
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_10">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a>SELECT * FROM your_model 
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>JOIN related_model ON your_model.related_id = related_model.id;
</code></pre></div></td></tr></table></div>
<h2 id="2-only-fetch-what-you-need">2. Only Fetch What You Need</h2>
<h3 id="django-orm_11">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a>YourModel.objects.only(&#39;field1&#39;, &#39;field2&#39;)
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_11">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a>session.query(YourModel.field1, YourModel.field2)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_11">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a>SELECT field1, field2 FROM your_model;
</code></pre></div></td></tr></table></div>
<h2 id="3-using-database-indexes">3. Using Database Indexes</h2>
<h3 id="django-orm_12">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span>
<span class="normal"><a href="#__codelineno-36-2">2</a></span>
<span class="normal"><a href="#__codelineno-36-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a># When defining the model, use db_index=True
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>class YourModel(models.Model):
<a id="__codelineno-36-3" name="__codelineno-36-3"></a>    field1 = models.CharField(max_length=100, db_index=True)
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_12">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span>
<span class="normal"><a href="#__codelineno-37-4">4</a></span>
<span class="normal"><a href="#__codelineno-37-5">5</a></span>
<span class="normal"><a href="#__codelineno-37-6">6</a></span>
<span class="normal"><a href="#__codelineno-37-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a># Define the index within the table
<a id="__codelineno-37-2" name="__codelineno-37-2"></a>from sqlalchemy import Index, create_engine, MetaData
<a id="__codelineno-37-3" name="__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a>meta = MetaData()
<a id="__codelineno-37-5" name="__codelineno-37-5"></a>your_table = Table(&#39;your_model&#39;, meta,
<a id="__codelineno-37-6" name="__codelineno-37-6"></a>    Column(&#39;field1&#39;, String, index=True)
<a id="__codelineno-37-7" name="__codelineno-37-7"></a>)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_12">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a>CREATE INDEX index_name ON your_model (field1);
</code></pre></div></td></tr></table></div>
<h2 id="4-batch-inserts">4. Batch Inserts</h2>
<h3 id="django-orm_13">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a># Using bulk_create
<a id="__codelineno-39-2" name="__codelineno-39-2"></a>YourModel.objects.bulk_create([YourModel(field1=value) for value in value_list])
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_13">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a>session.bulk_insert_mappings(YourModel, [{&#39;field1&#39;: value} for value in value_list])
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_13">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a>INSERT INTO your_model (field1) VALUES (value1), (value2), ...;
</code></pre></div></td></tr></table></div>
<h2 id="5-optimizing-count-queries">5. Optimizing Count Queries</h2>
<h3 id="django-orm_14">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a>YourModel.objects.filter(some_criteria=True).count()
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_14">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a>session.query(func.count(YourModel.id)).filter(YourModel.some_criteria == True)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_14">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a>SELECT COUNT(id) FROM your_model WHERE some_criteria = TRUE;
</code></pre></div></td></tr></table></div>
<h2 id="6-use-exists-for-presence-checks">6. Use EXISTS for Presence Checks</h2>
<h3 id="django-orm_15">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a>if YourModel.objects.filter(field1=value).exists():
<a id="__codelineno-45-2" name="__codelineno-45-2"></a>    # Do something
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_15">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a>if session.query(YourModel).filter(YourModel.field1 == value).limit(1).first():
<a id="__codelineno-46-2" name="__codelineno-46-2"></a>    # Do something
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_15">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a>SELECT EXISTS(SELECT 1 FROM your_model WHERE field1 = value);
</code></pre></div></td></tr></table></div>
<h2 id="7-use-database-functions-for-computation">7. Use Database Functions for Computation</h2>
<h3 id="django-orm_16">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a>from django.db.models.functions import Coalesce
<a id="__codelineno-48-2" name="__codelineno-48-2"></a>YourModel.objects.update(field2=Coalesce(&#39;field2&#39;, 0) + 1)
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_16">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a>from sqlalchemy.sql.expression import func
<a id="__codelineno-49-2" name="__codelineno-49-2"></a>session.query(YourModel).update({YourModel.field2: func.coalesce(YourModel.field2, 0) + 1})
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_16">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a>UPDATE your_model SET field2 = COALESCE(field2, 0) + 1;
</code></pre></div></td></tr></table></div>
<h2 id="8-avoiding-orm-overhead-for-large-data-sets">8. Avoiding ORM Overhead for Large Data Sets</h2>
<h3 id="django-orm_17">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a>YourModel.objects.values(&#39;field1&#39;, &#39;field2&#39;)
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_17">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a>session.query(YourModel.field1, YourModel.field2).yield_per(1000)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_17">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a>SELECT field1, field2 FROM your_model;
</code></pre></div></td></tr></table></div>
<h2 id="9-de-normalization-for-faster-reads">9. De-normalization for Faster Reads</h2>
<h3 id="django-orm_18">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span>
<span class="normal"><a href="#__codelineno-54-3">3</a></span>
<span class="normal"><a href="#__codelineno-54-4">4</a></span>
<span class="normal"><a href="#__codelineno-54-5">5</a></span>
<span class="normal"><a href="#__codelineno-54-6">6</a></span>
<span class="normal"><a href="#__codelineno-54-7">7</a></span>
<span class="normal"><a href="#__codelineno-54-8">8</a></span>
<span class="normal"><a href="#__codelineno-54-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a># Using annotated fields or computed properties
<a id="__codelineno-54-2" name="__codelineno-54-2"></a>class YourModel(models.Model):
<a id="__codelineno-54-3" name="__codelineno-54-3"></a>    field1 = models.IntegerField()
<a id="__codelineno-54-4" name="__codelineno-54-4"></a>    field2 = models.IntegerField()
<a id="__codelineno-54-5" name="__codelineno-54-5"></a>    total = models.IntegerField(editable=False)
<a id="__codelineno-54-6" name="__codelineno-54-6"></a>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a>    def save(self, *args, **kwargs):
<a id="__codelineno-54-8" name="__codelineno-54-8"></a>        self.total = self.field1 + self.field2
<a id="__codelineno-54-9" name="__codelineno-54-9"></a>        super().save(*args, **kwargs)
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_18">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-55-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-55-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-55-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-55-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-55-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-55-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-55-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-55-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-55-10">10</a></span>
<span class="normal"><a href="#__codelineno-55-11">11</a></span>
<span class="normal"><a href="#__codelineno-55-12">12</a></span>
<span class="normal"><a href="#__codelineno-55-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a>from sqlalchemy import Column, Integer, event
<a id="__codelineno-55-2" name="__codelineno-55-2"></a>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a>class YourModel(Base):
<a id="__codelineno-55-4" name="__codelineno-55-4"></a>    __tablename__ = &#39;your_model&#39;
<a id="__codelineno-55-5" name="__codelineno-55-5"></a>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a>    id = Column(Integer, primary_key=True)
<a id="__codelineno-55-7" name="__codelineno-55-7"></a>    field1 = Column(Integer)
<a id="__codelineno-55-8" name="__codelineno-55-8"></a>    field2 = Column(Integer)
<a id="__codelineno-55-9" name="__codelineno-55-9"></a>    total = Column(Integer)
<a id="__codelineno-55-10" name="__codelineno-55-10"></a>
<a id="__codelineno-55-11" name="__codelineno-55-11"></a>@event.listens_for(YourModel, &#39;before_insert&#39;)
<a id="__codelineno-55-12" name="__codelineno-55-12"></a>def before_insert(mapper, connection, target):
<a id="__codelineno-55-13" name="__codelineno-55-13"></a>    target.total = target.field1 + target.field2
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_18">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span>
<span class="normal"><a href="#__codelineno-56-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a>-- Assuming the total column is already added to your_model
<a id="__codelineno-56-2" name="__codelineno-56-2"></a>UPDATE your_model SET total = field1 + field2;
</code></pre></div></td></tr></table></div>
<h2 id="10-caching-expensive-queries">10. Caching Expensive Queries</h2>
<h3 id="django-orm_19">Django ORM:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span>
<span class="normal"><a href="#__codelineno-57-2">2</a></span>
<span class="normal"><a href="#__codelineno-57-3">3</a></span>
<span class="normal"><a href="#__codelineno-57-4">4</a></span>
<span class="normal"><a href="#__codelineno-57-5">5</a></span>
<span class="normal"><a href="#__codelineno-57-6">6</a></span>
<span class="normal"><a href="#__codelineno-57-7">7</a></span>
<span class="normal"><a href="#__codelineno-57-8">8</a></span>
<span class="normal"><a href="#__codelineno-57-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a># Using Django&#39;s cache framework
<a id="__codelineno-57-2" name="__codelineno-57-2"></a>from django.core.cache import cache
<a id="__codelineno-57-3" name="__codelineno-57-3"></a>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a>key = &quot;your_cache_key&quot;
<a id="__codelineno-57-5" name="__codelineno-57-5"></a>data = cache.get(key)
<a id="__codelineno-57-6" name="__codelineno-57-6"></a>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a>if data is None:
<a id="__codelineno-57-8" name="__codelineno-57-8"></a>    data = YourModel.objects.filter(some_criteria=True)
<a id="__codelineno-57-9" name="__codelineno-57-9"></a>    cache.set(key, data)
</code></pre></div></td></tr></table></div>
<h3 id="sqlalchemy_19">SQLAlchemy:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-58-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-58-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-58-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-58-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-58-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-58-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-58-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-58-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-58-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a># Using dogpile.cache for SQLAlchemy
<a id="__codelineno-58-2" name="__codelineno-58-2"></a>from dogpile.cache import make_region
<a id="__codelineno-58-3" name="__codelineno-58-3"></a>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a>region = make_region().configure(&#39;dogpile.cache.memory&#39;, expiration_time=3600)
<a id="__codelineno-58-5" name="__codelineno-58-5"></a>key = &quot;your_cache_key&quot;
<a id="__codelineno-58-6" name="__codelineno-58-6"></a>data = region.get(key)
<a id="__codelineno-58-7" name="__codelineno-58-7"></a>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a>if data is None:
<a id="__codelineno-58-9" name="__codelineno-58-9"></a>    data = session.query(YourModel).filter(YourModel.some_criteria == True).all()
<a id="__codelineno-58-10" name="__codelineno-58-10"></a>    region.set(key, data)
</code></pre></div></td></tr></table></div>
<h3 id="raw-sql_19">Raw SQL:</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span>
<span class="normal"><a href="#__codelineno-59-2">2</a></span>
<span class="normal"><a href="#__codelineno-59-3">3</a></span>
<span class="normal"><a href="#__codelineno-59-4">4</a></span>
<span class="normal"><a href="#__codelineno-59-5">5</a></span>
<span class="normal"><a href="#__codelineno-59-6">6</a></span>
<span class="normal"><a href="#__codelineno-59-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a>-- This varies by the database and specific caching solutions. Typically, databases have their internal caching mechanisms for frequent queries.
<a id="__codelineno-59-2" name="__codelineno-59-2"></a>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a># Deep Dive into Advanced ORM Techniques: Django, SQLAlchemy &amp; Raw SQL
<a id="__codelineno-59-4" name="__codelineno-59-4"></a>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a>## 11. Composite Primary Keys
<a id="__codelineno-59-6" name="__codelineno-59-6"></a>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a>### Django ORM:
</code></pre></div></td></tr></table></div>
<h1 id="django-does-not-natively-support-composite-primary-keys-however-you-can-use-a-unique-constraint">Django does not natively support composite primary keys. However, you can use a unique constraint.</h1>
<p>class YourModel(models.Model):
    field1 = models.IntegerField()
    field2 = models.IntegerField()</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>class Meta:
    constraints = [
        models.UniqueConstraint(fields=[&#39;field1&#39;, &#39;field2&#39;], name=&#39;unique_field1_field2&#39;)
    ]
</code></pre></div></td></tr></table></div>
<p>```
</p>
<h3 id="sqlalchemy_20">SQLAlchemy:</h3>
<p>```
from sqlalchemy import Column, Integer, PrimaryKeyConstraint</p>
<p>class YourModel(Base):
    <strong>tablename</strong> = 'your_model'</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>field1 = Column(Integer)
field2 = Column(Integer)

__table_args__ = (
    PrimaryKeyConstraint(&#39;field1&#39;, &#39;field2&#39;),
)
</code></pre></div></td></tr></table></div>
<p>```
</p>
<h3 id="raw-sql_20">Raw SQL:</h3>
<p><code>CREATE TABLE your_model (
    field1 INT,
    field2 INT,
    PRIMARY KEY (field1, field2)
);</code>
</p>
<h2 id="12-using-views">12. Using Views</h2>
<h3 id="django-orm_20">Django ORM:</h3>
<p>```</p>
<h1 id="create-a-view-in-your-database-then-create-a-model-mapped-to-this-view-ensure-db_table-points-to-the-view">Create a view in your database, then create a model mapped to this view. Ensure db_table points to the view.</h1>
<p>class YourViewModel(models.Model):
    field1 = models.IntegerField()
    field2 = models.IntegerField()</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>class Meta:
    managed = False  # Django will not manage this table
    db_table = &#39;your_view&#39;
</code></pre></div></td></tr></table></div>
<p>```
</p>
<h3 id="sqlalchemy_21">SQLAlchemy:</h3>
<p>```</p>
<h1 id="map-the-model-to-an-existing-view">Map the model to an existing view.</h1>
<p>class YourViewModel(Base):
    <strong>tablename</strong> = 'your_view'
    field1 = Column(Integer, primary_key=True)
    field2 = Column(Integer)
```
</p>
<h3 id="raw-sql_21">Raw SQL:</h3>
<p><code>CREATE VIEW your_view AS
SELECT field1, field2 FROM your_model WHERE some_criteria = TRUE;</code>
</p>
<h2 id="13-temporary-tables">13. Temporary Tables</h2>
<h3 id="django-orm_21">Django ORM:</h3>
<p>```</p>
<h1 id="django-orm-doesnt-have-built-in-support-for-temporary-tables-youd-typically-create-them-using-raw-sql">Django ORM doesn't have built-in support for temporary tables. You'd typically create them using raw SQL.</h1>
<p>from django.db import connection</p>
<p>with connection.cursor() as cursor:
    cursor.execute('''
        CREATE TEMPORARY TABLE temp_your_model AS
        SELECT * FROM your_model WHERE some_criteria = TRUE;
    ''')
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a>### SQLAlchemy:
</code></pre></div></td></tr></table></div></p>
<h1 id="use-the-standard-table-creation-but-specify-it-as-a-temporary-table">Use the standard table creation but specify it as a temporary table.</h1>
<p>temp_table = Table(
    "temp_your_model", metadata,
    Column('field1', Integer),
    # Add other columns...
    prefixes=['TEMPORARY']
)
temp_table.create(bind=engine)
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a>### Raw SQL:
</code></pre></div></td></tr></table></div>
CREATE TEMPORARY TABLE temp_your_model AS
SELECT * FROM your_model WHERE some_criteria = TRUE;
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span>
<span class="normal"><a href="#__codelineno-68-2">2</a></span>
<span class="normal"><a href="#__codelineno-68-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a>## 14. Recursive Queries (Common Table Expressions)
<a id="__codelineno-68-2" name="__codelineno-68-2"></a>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a>### Django ORM:
</code></pre></div></td></tr></table></div></p>
<h1 id="django-31-introduced-support-for-recursive-ctes">Django 3.1 introduced support for recursive CTEs</h1>
<p>from django_cte import CTEManager, CTEQuerySet</p>
<p>class YourModel(models.Model):
    parent = models.ForeignKey('self', null=True, on_delete=models.CASCADE)
    name = models.CharField(max_length=200)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>objects = CTEManager.from_queryset(CTEQuerySet)()
</code></pre></div></td></tr></table></div>
<p>with YourModel.objects.with_cte(recursive=True) as cte:
    cte_qs = cte.queryset.annotate(level=models.Value(0)).filter(name="root_name")
    children_qs = cte.queryset.filter(parent=cte.join()).annotate(level=cte.col.level + 1)
    cte.union(cte_qs, children_qs)
    results = cte.all()
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a>### SQLAlchemy:
</code></pre></div></td></tr></table></div>
from sqlalchemy import select, union_all
from sqlalchemy.orm import aliased</p>
<p>descendants = select([
    YourModel.id, YourModel.parent_id, YourModel.name
]).where(YourModel.name == 'root_name').cte(name='descendants', recursive=True)</p>
<p>parent_alias = aliased(descendants)
children = select([
    YourModel.id, YourModel.parent_id, YourModel.name
]).join(
    parent_alias, parent_alias.c.id == YourModel.parent_id
)</p>
<p>descendants = descendants.union_all(children)
session.query(descendants).all()
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a>### Raw SQL:
</code></pre></div></td></tr></table></div>
WITH RECURSIVE descendants AS (
    SELECT id, parent_id, name
    FROM your_model WHERE name = 'root_name'</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code>UNION ALL

SELECT m.id, m.parent_id, m.name
FROM your_model m
JOIN descendants d ON d.id = m.parent_id
</code></pre></div></td></tr></table></div>
<p>)
SELECT * FROM descendants;
```
</p>
<h2 id="15-upserts-insert-or-update">15. Upserts (Insert or Update)</h2>
<h3 id="django-orm_22">Django ORM:</h3>
<p>```
from django.db import IntegrityError</p>
<p>try:
    YourModel.objects.create(id=some_id, field1=value1)
except IntegrityError:
    YourModel.objects.filter(id=some_id).update(field1=value1)
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a>### SQLAlchemy:
</code></pre></div></td></tr></table></div>
from sqlalchemy.dialects.postgresql import insert</p>
<p>stmt = insert(YourModel).values(id=some_id, field1=value1)
stmt = stmt.on_conflict_do_update(
    index_elements=['id'],
    set_=dict(field1=value1)
)
session.execute(stmt)
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a>### Raw SQL:
</code></pre></div></td></tr></table></div>
INSERT INTO your_model (id, field1)
VALUES (some_id, 'value1')
ON CONFLICT (id) DO UPDATE
SET field1 = 'value1';
```</p>
<hr />
<p>These are some deeper techniques and features that can be utilized in ORMs and SQL to optimize, enhance, and leverage powerful database features. Remember that the most suitable technique always depends on the specific problem you're solving, the database you're using, and the scale at which you operate.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>