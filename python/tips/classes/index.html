
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.1">
    
    
      
        <title>classes - David</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e8d9bf0c.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#much-about-classes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="David" class="md-header__button md-logo" aria-label="David" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            David
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              classes
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="David" class="md-nav__button md-logo" aria-label="David" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    David
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Recipes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Recipes" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Recipes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_1" type="checkbox" id="__nav_2_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_1">
          Python Cookbook
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python Cookbook" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_1">
          <span class="md-nav__icon md-icon"></span>
          Python Cookbook
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ipynb/cookbook/" class="md-nav__link">
        Python Cookbook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ipynb/cookbook2/" class="md-nav__link">
        Part 2
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_2" type="checkbox" id="__nav_2_1_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1_2">
          Python Distilled
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python Distilled" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_1_2">
          <span class="md-nav__icon md-icon"></span>
          Python Distilled
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        python structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../modules/" class="md-nav__link">
        modules
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          classes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        classes
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#classes-and-object-oriented-programming" class="md-nav__link">
    Classes and object oriented programming
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avoid-inheritance-via-composition" class="md-nav__link">
    avoid inheritance via composition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avoid-inheritence-via-functions" class="md-nav__link">
    avoid inheritence via functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-binding-and-duck-typing" class="md-nav__link">
    Dynamic Binding and Duck Typing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dont-inherit-builtin-types" class="md-nav__link">
    don't inherit builtin types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-variables-vs-methods" class="md-nav__link">
    class Variables vs Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-of-classes" class="md-nav__link">
    Configuration of classes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statismethods" class="md-nav__link">
    Statismethods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-design-patterns" class="md-nav__link">
    about Design Patterns
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#properties" class="md-nav__link">
    properties
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types-interfaces-abs-classes" class="md-nav__link">
    types, interfaces, abs classes
  </a>
  
    <nav class="md-nav" aria-label="types, interfaces, abs classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#abc-must-to-be-implemented" class="md-nav__link">
    ABC must to be implemented
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-inhertitance-and-mixins" class="md-nav__link">
    multiple inhertitance and mixins
  </a>
  
    <nav class="md-nav" aria-label="multiple inhertitance and mixins">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mixin-classes" class="md-nav__link">
    mixin classes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cooperative-multiple-inheritence-and-mro" class="md-nav__link">
    cooperative multiple inheritence and mro
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#super" class="md-nav__link">
    super ()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#type-based-dispach" class="md-nav__link">
    type based dispach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-decorators" class="md-nav__link">
    class decorators
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-decorator-oveerride-function" class="md-nav__link">
    class decorator oveerride function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-code-to-class-at-runtime" class="md-nav__link">
    add code  to class at runtime
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supervised-inheritence-init-subclass" class="md-nav__link">
    supervised inheritence - init subclass
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#object-life-cycle-and-memory-management" class="md-nav__link">
    object life cycle and memory management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weak-references" class="md-nav__link">
    weak references
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attribute-binding" class="md-nav__link">
    attribute binding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxies-wrappers-delegations" class="md-nav__link">
    proxies, wrappers, delegations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slots" class="md-nav__link">
    slots
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#descriptors" class="md-nav__link">
    Descriptors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method-descriptor" class="md-nav__link">
    method descriptor
  </a>
  
    <nav class="md-nav" aria-label="method descriptor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lazy-evaluation" class="md-nav__link">
    lazy evaluation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-class-creation" class="md-nav__link">
    dynamic class creation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metaclasses" class="md-nav__link">
    metaclasses
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#built-in-objects-for-instances-and-classes" class="md-nav__link">
    Built-in Objects for Instances and Classes
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        IO
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Odoo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Odoo" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Odoo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../odoo/models/" class="md-nav__link">
        Odoo Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../odoo/views/" class="md-nav__link">
        Odoo Views
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../odoo/server_side/" class="md-nav__link">
        server side development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../odoo/debug/" class="md-nav__link">
        Odoo debug
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../odoo/xml/" class="md-nav__link">
        Odoo xml
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../odoo/raw/" class="md-nav__link">
        Advanced Back End
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../odoo/tips/" class="md-nav__link">
        Some Tims
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../git/git/" class="md-nav__link">
        Git
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tools" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/pre-commit/" class="md-nav__link">
        pre-commit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/aactivator/" class="md-nav__link">
        aactivator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#classes-and-object-oriented-programming" class="md-nav__link">
    Classes and object oriented programming
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avoid-inheritance-via-composition" class="md-nav__link">
    avoid inheritance via composition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avoid-inheritence-via-functions" class="md-nav__link">
    avoid inheritence via functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-binding-and-duck-typing" class="md-nav__link">
    Dynamic Binding and Duck Typing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dont-inherit-builtin-types" class="md-nav__link">
    don't inherit builtin types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-variables-vs-methods" class="md-nav__link">
    class Variables vs Methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-of-classes" class="md-nav__link">
    Configuration of classes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statismethods" class="md-nav__link">
    Statismethods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-design-patterns" class="md-nav__link">
    about Design Patterns
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#properties" class="md-nav__link">
    properties
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types-interfaces-abs-classes" class="md-nav__link">
    types, interfaces, abs classes
  </a>
  
    <nav class="md-nav" aria-label="types, interfaces, abs classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#abc-must-to-be-implemented" class="md-nav__link">
    ABC must to be implemented
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-inhertitance-and-mixins" class="md-nav__link">
    multiple inhertitance and mixins
  </a>
  
    <nav class="md-nav" aria-label="multiple inhertitance and mixins">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mixin-classes" class="md-nav__link">
    mixin classes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cooperative-multiple-inheritence-and-mro" class="md-nav__link">
    cooperative multiple inheritence and mro
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#super" class="md-nav__link">
    super ()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#type-based-dispach" class="md-nav__link">
    type based dispach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-decorators" class="md-nav__link">
    class decorators
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#class-decorator-oveerride-function" class="md-nav__link">
    class decorator oveerride function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-code-to-class-at-runtime" class="md-nav__link">
    add code  to class at runtime
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supervised-inheritence-init-subclass" class="md-nav__link">
    supervised inheritence - init subclass
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#object-life-cycle-and-memory-management" class="md-nav__link">
    object life cycle and memory management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weak-references" class="md-nav__link">
    weak references
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attribute-binding" class="md-nav__link">
    attribute binding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxies-wrappers-delegations" class="md-nav__link">
    proxies, wrappers, delegations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#slots" class="md-nav__link">
    slots
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#descriptors" class="md-nav__link">
    Descriptors
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method-descriptor" class="md-nav__link">
    method descriptor
  </a>
  
    <nav class="md-nav" aria-label="method descriptor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lazy-evaluation" class="md-nav__link">
    lazy evaluation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-class-creation" class="md-nav__link">
    dynamic class creation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metaclasses" class="md-nav__link">
    metaclasses
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#built-in-objects-for-instances-and-classes" class="md-nav__link">
    Built-in Objects for Instances and Classes
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="much-about-classes">Much about classes</h1>
<h2 id="classes-and-object-oriented-programming">Classes and object oriented programming</h2>
<p>Classes are used to create new kinds of objects.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">class</span> <span class="nc">AccountPortfolio</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="k">def</span> <span class="nf">add_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">):</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="k">def</span> <span class="nf">total_funds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">inquiry</span><span class="p">()</span> <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="c1"># Example</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="n">port</span> <span class="o">=</span> <span class="n">AccountPortfolio</span><span class="p">()</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="n">port</span><span class="o">.</span><span class="n">add_account</span><span class="p">(</span><span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">))</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="n">port</span><span class="o">.</span><span class="n">add_account</span><span class="p">(</span><span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Eva&#39;</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">))</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="nb">print</span><span class="p">(</span><span class="n">port</span><span class="o">.</span><span class="n">total_funds</span><span class="p">())</span>    <span class="c1"># -&gt; 1050.0</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="nb">len</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>                    <span class="c1"># -&gt; 2</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="c1"># Print the accounts</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">port</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="c1"># Access an individual account by index</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="n">port</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">inquiry</span><span class="p">()</span>            <span class="c1"># -&gt; 50.0</span>
</code></pre></div>
<h2 id="avoid-inheritance-via-composition">avoid inheritance via composition</h2>
<p>inheritence</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">class</span> <span class="nc">Stack</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="c1"># Example</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="n">s</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">()</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>     <span class="c1"># -&gt; 3</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>     <span class="c1"># -&gt; 2</span>
</code></pre></div>
composition</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">class</span> <span class="nc">Stack</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="c1"># Example use</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="n">s</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">()</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>    <span class="c1"># -&gt; 3</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>    <span class="c1"># -&gt; 2</span>
</code></pre></div>
<p>pass container as argument </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">class</span> <span class="nc">Stack</span><span class="p">:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>        <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>            <span class="n">container</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="n">container</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="n">s</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">))</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;a lot&#39;</span><span class="p">)</span>     <span class="c1"># TypeError</span>
</code></pre></div>
<p>This is also an example of what’s known as dependency injection. Instead of hardwiring Stack to depend on list, you can make it depend on any container a user decides to pass in, provided it implements the required interface.</p>
<h2 id="avoid-inheritence-via-functions">avoid inheritence via functions</h2>
<p>there is too much plumbing going on here. If you’re writing a lot of single-method classes, consider using functions instead. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">class</span> <span class="nc">DataParser</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>        <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>            <span class="n">row</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>            <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_record</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>            <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>        <span class="k">return</span> <span class="n">records</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="k">def</span> <span class="nf">make_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="k">class</span> <span class="nc">PortfolioDataParser</span><span class="p">(</span><span class="n">DataParser</span><span class="p">):</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>    <span class="k">def</span> <span class="nf">make_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>           <span class="s1">&#39;shares&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>           <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>        <span class="p">}</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="n">parser</span> <span class="o">=</span> <span class="n">PortfolioDataParser</span><span class="p">()</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="n">data</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;portfolio.csv&#39;</span><span class="p">))</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="k">def</span> <span class="nf">parse_data</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">make_record</span><span class="p">):</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>    <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a>        <span class="n">row</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>        <span class="n">record</span> <span class="o">=</span> <span class="n">make_record</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a>        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a>    <span class="k">return</span> <span class="n">records</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="k">def</span> <span class="nf">make_dict</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a>        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a>        <span class="s1">&#39;shares&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-4-37" name="__codelineno-4-37"></a>        <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-4-38" name="__codelineno-4-38"></a>    <span class="p">}</span>
<a id="__codelineno-4-39" name="__codelineno-4-39"></a>
<a id="__codelineno-4-40" name="__codelineno-4-40"></a><span class="n">data</span> <span class="o">=</span> <span class="n">parse_data</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;portfolio.csv&#39;</span><span class="p">),</span> <span class="n">make_dict</span><span class="p">)</span>
</code></pre></div>
<h2 id="dynamic-binding-and-duck-typing">Dynamic Binding and Duck Typing</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">Dynamic</span> <span class="n">binding</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">runtime</span> <span class="n">mechanism</span> <span class="n">that</span> <span class="n">Python</span> <span class="n">uses</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">attributes</span> <span class="n">of</span> <span class="n">objects</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">what</span> <span class="n">allows</span> <span class="n">Python</span> <span class="n">to</span> <span class="n">work</span> <span class="k">with</span> <span class="n">instances</span> <span class="n">without</span> <span class="n">regard</span> <span class="k">for</span> <span class="n">their</span> <span class="nb">type</span><span class="o">.</span> <span class="n">In</span> <span class="n">Python</span><span class="p">,</span> <span class="n">variable</span> <span class="n">names</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">have</span> <span class="n">an</span> <span class="n">associated</span> <span class="nb">type</span><span class="o">.</span> <span class="n">Thus</span><span class="p">,</span> <span class="n">the</span> <span class="n">attribute</span> <span class="n">binding</span> <span class="n">process</span> <span class="ow">is</span> <span class="n">independent</span> <span class="n">of</span> <span class="n">what</span> <span class="n">kind</span> <span class="n">of</span> <span class="nb">object</span> <span class="n">obj</span> <span class="ow">is</span><span class="o">.</span> <span class="n">If</span> <span class="n">you</span> <span class="n">make</span> <span class="n">a</span> <span class="n">lookup</span><span class="p">,</span> <span class="n">such</span> <span class="k">as</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">it</span> <span class="n">will</span> <span class="n">work</span> <span class="n">on</span> <span class="nb">any</span> <span class="n">obj</span> <span class="n">whatsoever</span> <span class="n">that</span> <span class="n">happens</span> <span class="n">to</span> <span class="n">have</span> <span class="n">a</span> <span class="n">name</span> <span class="n">attribute</span><span class="o">.</span> <span class="n">This</span> <span class="n">behavior</span> <span class="ow">is</span> <span class="n">sometimes</span> <span class="n">referred</span> <span class="n">to</span> <span class="k">as</span> <span class="n">duck</span> <span class="n">typing</span><span class="err">—</span><span class="ow">in</span> <span class="n">reference</span> <span class="n">to</span> <span class="n">the</span> <span class="n">adage</span> <span class="err">“</span><span class="k">if</span> <span class="n">it</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">a</span> <span class="n">duck</span><span class="p">,</span> <span class="n">quacks</span> <span class="n">like</span> <span class="n">a</span> <span class="n">duck</span><span class="p">,</span> <span class="ow">and</span> <span class="n">walks</span> <span class="n">like</span> <span class="n">a</span> <span class="n">duck</span><span class="p">,</span> <span class="n">then</span> <span class="n">it</span><span class="err">’</span><span class="n">s</span> <span class="n">a</span> <span class="n">duck</span><span class="o">.</span><span class="err">”</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">Python</span> <span class="n">programmers</span> <span class="n">often</span> <span class="n">write</span> <span class="n">programs</span> <span class="n">that</span> <span class="n">rely</span> <span class="n">on</span> <span class="n">this</span> <span class="n">behavior</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span><span class="p">,</span> <span class="k">if</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">make</span> <span class="n">a</span> <span class="n">customized</span> <span class="n">version</span> <span class="n">of</span> <span class="n">an</span> <span class="n">existing</span> <span class="nb">object</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">either</span> <span class="n">inherit</span> <span class="kn">from</span> <span class="nn">it</span><span class="p">,</span> <span class="ow">or</span> <span class="n">you</span> <span class="n">can</span> <span class="n">create</span> <span class="n">a</span> <span class="n">completely</span> <span class="n">new</span> <span class="nb">object</span> <span class="n">that</span> <span class="n">looks</span> <span class="ow">and</span> <span class="n">acts</span> <span class="n">like</span> <span class="n">it</span> <span class="n">but</span> <span class="ow">is</span> <span class="n">otherwise</span> <span class="n">unrelated</span><span class="o">.</span> <span class="n">This</span> <span class="n">latter</span> <span class="n">approach</span> <span class="ow">is</span> <span class="n">often</span> <span class="n">used</span> <span class="n">to</span> <span class="n">maintain</span> <span class="n">loose</span> <span class="n">coupling</span> <span class="n">of</span> <span class="n">program</span> <span class="n">components</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span><span class="p">,</span> <span class="n">code</span> <span class="n">may</span> <span class="n">be</span> <span class="n">written</span> <span class="n">to</span> <span class="n">work</span> <span class="k">with</span> <span class="nb">any</span> <span class="n">kind</span> <span class="n">of</span> <span class="nb">object</span> <span class="n">whatsoever</span> <span class="k">as</span> <span class="n">long</span> <span class="k">as</span> <span class="n">it</span> <span class="n">has</span> <span class="n">a</span> <span class="n">certain</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">methods</span><span class="o">.</span> <span class="n">One</span> <span class="n">of</span> <span class="n">the</span> <span class="n">most</span> <span class="n">common</span> <span class="n">examples</span> <span class="ow">is</span> <span class="k">with</span> <span class="n">various</span> <span class="n">iterable</span> <span class="n">objects</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">standard</span> <span class="n">library</span><span class="o">.</span> <span class="n">There</span> <span class="n">are</span> <span class="nb">all</span> <span class="n">sorts</span> <span class="n">of</span> <span class="n">objects</span> <span class="n">that</span> <span class="n">work</span> <span class="k">with</span> <span class="n">the</span> <span class="k">for</span> <span class="n">loop</span> <span class="n">to</span> <span class="n">produce</span> <span class="n">values</span><span class="err">—</span><span class="n">lists</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">generators</span><span class="p">,</span> <span class="n">strings</span><span class="p">,</span> <span class="ow">and</span> <span class="n">so</span> <span class="n">on</span><span class="o">.</span> <span class="n">However</span><span class="p">,</span> <span class="n">none</span> <span class="n">of</span> <span class="n">these</span> <span class="n">inherit</span> <span class="kn">from</span> <span class="nn">any</span> <span class="n">kind</span> <span class="n">of</span> <span class="n">special</span> <span class="n">Iterable</span> <span class="n">base</span> <span class="n">class</span><span class="o">.</span> <span class="n">They</span> <span class="n">merely</span> <span class="n">implement</span> <span class="n">the</span> <span class="n">methods</span> <span class="n">required</span> <span class="n">to</span> <span class="n">perform</span> <span class="n">iteration</span><span class="err">—</span><span class="ow">and</span> <span class="n">it</span> <span class="nb">all</span> <span class="n">works</span><span class="o">.</span>
</code></pre></div>
<h2 id="dont-inherit-builtin-types">don't inherit builtin types</h2>
<p>dict, list they are written in C and buypass <strong>setitem</strong> and <em>getitem</em></p>
<p>if you want use : from collections import UserDict</p>
<h2 id="class-variables-vs-methods">class Variables vs Methods</h2>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">In</span> <span class="n">a</span> <span class="k">class</span> <span class="nc">definition</span><span class="p">,</span> <span class="nb">all</span> <span class="n">functions</span> <span class="n">are</span> <span class="n">assumed</span> <span class="n">to</span> <span class="n">operate</span> <span class="n">on</span> <span class="n">an</span> <span class="n">instance</span><span class="p">,</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">always</span> <span class="n">passed</span> <span class="k">as</span> <span class="n">the</span> <span class="n">first</span> <span class="n">parameter</span> <span class="bp">self</span><span class="o">.</span> <span class="n">However</span><span class="p">,</span> <span class="n">the</span> <span class="k">class</span> <span class="nc">itself</span> <span class="ow">is</span> <span class="n">also</span> <span class="n">an</span> <span class="nb">object</span> <span class="n">that</span> <span class="n">can</span> <span class="n">carry</span> <span class="n">state</span> <span class="ow">and</span> <span class="n">be</span> <span class="n">manipulated</span> <span class="k">as</span> <span class="n">well</span><span class="o">.</span> <span class="n">As</span> <span class="n">an</span> <span class="n">example</span><span class="p">,</span> <span class="n">you</span> <span class="n">could</span> <span class="n">track</span> <span class="n">how</span> <span class="n">many</span> <span class="n">instances</span> <span class="n">have</span> <span class="n">been</span> <span class="n">created</span> <span class="n">using</span> <span class="n">a</span> <span class="k">class</span> <span class="nc">variable</span> <span class="n">num_accounts</span><span class="p">:</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="n">Click</span> <span class="n">here</span> <span class="n">to</span> <span class="n">view</span> <span class="n">code</span> <span class="n">image</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>    <span class="n">num_accounts</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>        <span class="n">Account</span><span class="o">.</span><span class="n">num_accounts</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="si">!r}</span><span class="s1">)&#39;</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="o">-</span><span class="n">amount</span><span class="p">)</span>    <span class="c1"># Must use self.deposit()</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a>    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="n">Class</span> <span class="n">variables</span> <span class="n">are</span> <span class="n">defined</span> <span class="n">outside</span> <span class="n">the</span> <span class="n">normal</span> <span class="fm">__init__</span><span class="p">()</span> <span class="n">method</span><span class="o">.</span> <span class="n">To</span> <span class="n">modify</span> <span class="n">them</span><span class="p">,</span> <span class="n">use</span> <span class="n">the</span> <span class="n">class</span><span class="p">,</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span> <span class="n">For</span> <span class="n">example</span><span class="p">:</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="n">Click</span> <span class="n">here</span> <span class="n">to</span> <span class="n">view</span> <span class="n">code</span> <span class="n">image</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Eva&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">Account</span><span class="o">.</span><span class="n">num_accounts</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="mi">2</span>
</code></pre></div>
classmethod usage.
alternative create of class
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>    <span class="k">def</span> <span class="nf">from_xml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>        <span class="kn">from</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">import</span> <span class="n">XML</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">XML</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s1">&#39;owner&#39;</span><span class="p">),</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>                   <span class="nb">float</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">findtext</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">)))</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="c1"># Example use</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="s1">&lt;account&gt;</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="s1">    &lt;owner&gt;Guido&lt;/owner&gt;</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="s1">    &lt;amount&gt;1000.0&lt;/amount&gt;</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="s1">&lt;/account&gt;</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">from_xml</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></p>
<h2 id="configuration-of-classes">Configuration of classes</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="k">class</span> <span class="nc">Date</span><span class="p">:</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>    <span class="n">datefmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{year}</span><span class="s1">-</span><span class="si">{month:02d}</span><span class="s1">-</span><span class="si">{day:02d}</span><span class="s1">&#39;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">month</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">day</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datefmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>                                   <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>                                   <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>    <span class="k">def</span> <span class="nf">from_timestamp</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a>        <span class="n">tm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">tm_year</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">tm_mon</span><span class="p">,</span> <span class="n">tm</span><span class="o">.</span><span class="n">tm_mday</span><span class="p">)</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a>    <span class="k">def</span> <span class="nf">today</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_timestamp</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="n">This</span> <span class="k">class</span> <span class="nc">features</span> <span class="n">a</span> <span class="k">class</span> <span class="nc">variable</span> <span class="n">datefmt</span> <span class="n">that</span> <span class="n">adjusts</span> <span class="n">output</span> <span class="kn">from</span> <span class="nn">the</span> <span class="fm">__str__</span><span class="p">()</span> <span class="n">method</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">something</span> <span class="n">that</span> <span class="n">can</span> <span class="n">be</span> <span class="n">customized</span> <span class="n">via</span> <span class="n">inheritance</span><span class="p">:</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="n">Click</span> <span class="n">here</span> <span class="n">to</span> <span class="n">view</span> <span class="n">code</span> <span class="n">image</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="k">class</span> <span class="nc">MDYDate</span><span class="p">(</span><span class="n">Date</span><span class="p">):</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a>    <span class="n">datefmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{month}</span><span class="s1">/</span><span class="si">{day}</span><span class="s1">/</span><span class="si">{year}</span><span class="s1">&#39;</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a><span class="k">class</span> <span class="nc">DMYDate</span><span class="p">(</span><span class="n">Date</span><span class="p">):</span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a>    <span class="n">datefmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{day}</span><span class="s1">/</span><span class="si">{month}</span><span class="s1">/</span><span class="si">{year}</span><span class="s1">&#39;</span>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a><span class="c1"># Example</span>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="mi">1967</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>       <span class="c1"># 1967-04-09</span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a><span class="n">b</span> <span class="o">=</span> <span class="n">MDYDate</span><span class="p">(</span><span class="mi">1967</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<a id="__codelineno-8-38" name="__codelineno-8-38"></a><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>       <span class="c1"># 4/9/1967</span>
<a id="__codelineno-8-39" name="__codelineno-8-39"></a>
<a id="__codelineno-8-40" name="__codelineno-8-40"></a><span class="n">c</span> <span class="o">=</span> <span class="n">DMYDate</span><span class="p">(</span><span class="mi">1967</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>      <span class="c1"># 9/4/1967</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="nb">dict</span><span class="o">.</span><span class="n">from_keys</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="c1">#{&#39;a&#39;: 0, &#39;b&#39;: 0, &#39;c&#39;: 0}</span>
</code></pre></div>
<h2 id="statismethods">Statismethods</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">class</span> <span class="nc">StandardPolicy</span><span class="p">:</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>        <span class="n">account</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>        <span class="n">account</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a>        <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="n">balance</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="k">class</span> <span class="nc">EvilPolicy</span><span class="p">(</span><span class="n">StandardPolicy</span><span class="p">):</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a>        <span class="n">account</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="mf">0.95</span><span class="o">*</span><span class="n">amount</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a>    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a>        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a>           <span class="k">return</span> <span class="mf">1.10</span> <span class="o">*</span> <span class="n">account</span><span class="o">.</span><span class="n">balance</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a>           <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="n">balance</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="n">StandardPolicy</span><span class="p">):</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">policy</span> <span class="o">=</span> <span class="n">policy</span>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a>
<a id="__codelineno-10-32" name="__codelineno-10-32"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-10-33" name="__codelineno-10-33"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Account(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">policy</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">owner</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="si">!r}</span><span class="s1">)&#39;</span>
<a id="__codelineno-10-34" name="__codelineno-10-34"></a>
<a id="__codelineno-10-35" name="__codelineno-10-35"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-10-36" name="__codelineno-10-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
<a id="__codelineno-10-37" name="__codelineno-10-37"></a>
<a id="__codelineno-10-38" name="__codelineno-10-38"></a>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-10-39" name="__codelineno-10-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
<a id="__codelineno-10-40" name="__codelineno-10-40"></a>
<a id="__codelineno-10-41" name="__codelineno-10-41"></a>    <span class="k">def</span> <span class="nf">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-10-42" name="__codelineno-10-42"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">inquiry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
<h2 id="about-design-patterns">about Design Patterns</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a>In writing object-oriented programs, programmers sometimes get fixated on implementing named design patterns—such as the “strategy pattern,” the “flyweight pattern,” the “singleton pattern,” and so forth. Many of these originate from the famous Design Patterns book by Erich Gamma, Richard Helm, Ralph Johnson, and John Vlissides.
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>If you are familiar with such patterns, the general design principles used in other languages can certainly be applied to Python. However, many of these documented patterns are aimed at working around specific issues that arise from the strict static type system of C++ or Java. The dynamic nature of Python renders a lot of these patterns obsolete, an overkill, or simply unnecessary.
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>That said, there are a few overarching principles of writing good software—such as striving to write code that is debuggable, testable, and extensible. Basic strategies such as writing classes with useful __repr__() methods, preferring composition over inheritance, and allowing dependency injection can go a long way towards these goals. Python programmers also like to work with code that can be said to be “Pythonic.” Usually, that means that objects obey various built-in protocols, such as iteration, containers, or context management. For example, instead of trying to implement some exotic data traversal pattern from a Java programming book, a Python programmer would probably implement it with a generator function feeding a for loop, or just replace the entire pattern with a few dictionary lookups.
</code></pre></div>
<h2 id="properties">properties</h2>
<p>As noted in the previous section, Python places no runtime restrictions on attribute values or types. However, such enforcement is possible if you put an attribute under the management of a so-called property. A property is a special kind of attribute that intercepts attribute access and handles it via user-defined methods. These methods have complete freedom to manage the attribute as they see fit. Here is an example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kn">import</span> <span class="nn">string</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>    <span class="nd">@property</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>    <span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>    <span class="nd">@owner</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>    <span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Expected str&#39;</span><span class="p">)</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must be uppercase ASCII&#39;</span><span class="p">)</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must be 10 characters or less&#39;</span><span class="p">)</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>    <span class="nd">@property</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting&#39;</span><span class="p">)</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>    <span class="nd">@attr</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>    <span class="nd">@attr</span><span class="o">.</span><span class="n">deleter</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>    <span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Deleting&#39;</span><span class="p">)</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="c1"># Example</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="n">s</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="n">s</span><span class="o">.</span><span class="n">attr</span>         <span class="c1"># Getting</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a><span class="n">s</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="mi">13</span>    <span class="c1"># Setting</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a><span class="k">del</span> <span class="n">s</span><span class="o">.</span><span class="n">attr</span>     <span class="c1"># Deleting</span>
</code></pre></div>
<h2 id="types-interfaces-abs-classes">types, interfaces, abs classes</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>    <span class="k">pass</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>    <span class="k">pass</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>    <span class="k">pass</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>           <span class="c1"># Instance of &#39;A&#39;</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>           <span class="c1"># Instance of &#39;B&#39;</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>           <span class="c1"># Instance of &#39;C&#39;</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>           <span class="c1"># Returns the class object A</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>  <span class="c1"># Returns True</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>  <span class="c1"># Returns True, B derives from A</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>  <span class="c1"># Returns False, B not derived from C</span>
</code></pre></div>
<h3 id="abc-must-to-be-implemented">ABC must to be implemented</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="k">class</span> <span class="nc">Stream</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>        <span class="k">pass</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a>        <span class="k">pass</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a>        <span class="k">pass</span> 
</code></pre></div>
<h2 id="multiple-inhertitance-and-mixins">multiple inhertitance and mixins</h2>
<p>interfaces using abc classes</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="k">class</span> <span class="nc">Stream</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>        <span class="k">pass</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a>        <span class="k">pass</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a>        <span class="k">pass</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="k">class</span> <span class="nc">Iterable</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a>        <span class="k">pass</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="k">class</span> <span class="nc">MessageStream</span><span class="p">(</span><span class="n">Stream</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a>    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a>        <span class="o">...</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a>        <span class="o">...</span>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-16-28" name="__codelineno-16-28"></a>        <span class="o">...</span>
<a id="__codelineno-16-29" name="__codelineno-16-29"></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-16-30" name="__codelineno-16-30"></a>        <span class="o">...</span>
<a id="__codelineno-16-31" name="__codelineno-16-31"></a>
<a id="__codelineno-16-32" name="__codelineno-16-32"></a><span class="n">m</span> <span class="o">=</span> <span class="n">MessageStream</span><span class="p">()</span>
<a id="__codelineno-16-33" name="__codelineno-16-33"></a>
<a id="__codelineno-16-34" name="__codelineno-16-34"></a><span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Stream</span><span class="p">)</span>     <span class="c1"># -&gt; True</span>
<a id="__codelineno-16-35" name="__codelineno-16-35"></a><span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>   <span class="c1"># -&gt; True</span>
</code></pre></div>
<h3 id="mixin-classes">mixin classes</h3>
<p>The other use of multiple inheritance is to define mixin classes. A mixin class is a class that modifies or extends the functionality of other classes. Consider the following class definitions:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="k">class</span> <span class="nc">Duck</span><span class="p">:</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>        <span class="k">return</span> <span class="s1">&#39;Quack&#39;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>    <span class="k">def</span> <span class="nf">waddle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>        <span class="k">return</span> <span class="s1">&#39;Waddle&#39;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="k">class</span> <span class="nc">Trombonist</span><span class="p">:</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>        <span class="k">return</span> <span class="s1">&#39;Blat!&#39;</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>    <span class="k">def</span> <span class="nf">march</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a>        <span class="k">return</span> <span class="s1">&#39;Clomp&#39;</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="k">class</span> <span class="nc">Cyclist</span><span class="p">:</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a>        <span class="k">return</span> <span class="s1">&#39;On your left!&#39;</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a>    <span class="k">def</span> <span class="nf">pedal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a>        <span class="k">return</span> <span class="s1">&#39;Pedaling&#39;</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="n">These</span> <span class="n">classes</span> <span class="n">are</span> <span class="n">completely</span> <span class="n">unrelated</span> <span class="n">to</span> <span class="n">each</span> <span class="n">other</span><span class="o">.</span> <span class="n">There</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">inheritance</span> <span class="n">relationship</span> <span class="ow">and</span> <span class="n">they</span> <span class="n">implement</span> <span class="n">different</span> <span class="n">methods</span><span class="o">.</span> <span class="n">However</span><span class="p">,</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">shared</span> <span class="n">commonality</span> <span class="ow">in</span> <span class="n">that</span> <span class="n">they</span> <span class="n">each</span> <span class="n">define</span> <span class="n">a</span> <span class="n">noise</span><span class="p">()</span> <span class="n">method</span><span class="o">.</span> <span class="n">Using</span> <span class="n">that</span> <span class="k">as</span> <span class="n">a</span> <span class="n">guide</span><span class="p">,</span> <span class="n">you</span> <span class="n">could</span> <span class="n">define</span> <span class="n">the</span> <span class="n">following</span> <span class="n">classes</span><span class="p">:</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="n">Click</span> <span class="n">here</span> <span class="n">to</span> <span class="n">view</span> <span class="n">code</span> <span class="n">image</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a><span class="k">class</span> <span class="nc">LoudMixin</span><span class="p">:</span>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-27" name="__codelineno-17-27"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a>
<a id="__codelineno-17-29" name="__codelineno-17-29"></a><span class="k">class</span> <span class="nc">AnnoyingMixin</span><span class="p">:</span>
<a id="__codelineno-17-30" name="__codelineno-17-30"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-31" name="__codelineno-17-31"></a>        <span class="k">return</span> <span class="mi">3</span><span class="o">*</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span>
<a id="__codelineno-17-32" name="__codelineno-17-32"></a>
<a id="__codelineno-17-33" name="__codelineno-17-33"></a>
<a id="__codelineno-17-34" name="__codelineno-17-34"></a><span class="k">class</span> <span class="nc">LoudDuck</span><span class="p">(</span><span class="n">LoudMixin</span><span class="p">,</span> <span class="n">Duck</span><span class="p">):</span>
<a id="__codelineno-17-35" name="__codelineno-17-35"></a>    <span class="k">pass</span>
<a id="__codelineno-17-36" name="__codelineno-17-36"></a>
<a id="__codelineno-17-37" name="__codelineno-17-37"></a><span class="k">class</span> <span class="nc">AnnoyingTrombonist</span><span class="p">(</span><span class="n">AnnoyingMixin</span><span class="p">,</span> <span class="n">Trombonist</span><span class="p">):</span>
<a id="__codelineno-17-38" name="__codelineno-17-38"></a>    <span class="k">pass</span>
<a id="__codelineno-17-39" name="__codelineno-17-39"></a>
<a id="__codelineno-17-40" name="__codelineno-17-40"></a><span class="k">class</span> <span class="nc">AnnoyingLoudCyclist</span><span class="p">(</span><span class="n">AnnoyingMixin</span><span class="p">,</span> <span class="n">LoudMixin</span><span class="p">,</span> <span class="n">Cyclist</span><span class="p">):</span>
<a id="__codelineno-17-41" name="__codelineno-17-41"></a>    <span class="k">pass</span>
<a id="__codelineno-17-42" name="__codelineno-17-42"></a>
<a id="__codelineno-17-43" name="__codelineno-17-43"></a><span class="n">d</span> <span class="o">=</span> <span class="n">LoudDuck</span><span class="p">()</span>
<a id="__codelineno-17-44" name="__codelineno-17-44"></a><span class="n">d</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span> <span class="c1"># -&gt; &#39;QUACK&#39;</span>
<a id="__codelineno-17-45" name="__codelineno-17-45"></a>
<a id="__codelineno-17-46" name="__codelineno-17-46"></a><span class="n">t</span> <span class="o">=</span> <span class="n">AnnoyingTrombonist</span><span class="p">()</span>
<a id="__codelineno-17-47" name="__codelineno-17-47"></a><span class="n">t</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span> <span class="c1"># -&gt; &#39;Blat!Blat!Blat!&#39;</span>
<a id="__codelineno-17-48" name="__codelineno-17-48"></a>
<a id="__codelineno-17-49" name="__codelineno-17-49"></a><span class="n">c</span> <span class="o">=</span> <span class="n">AnnoyingLoudCyclist</span><span class="p">()</span>
<a id="__codelineno-17-50" name="__codelineno-17-50"></a><span class="n">c</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span> <span class="c1"># -&gt; &#39;ON YOUR LEFT!ON YOUR LEFT!ON YOUR LEFT!&#39;</span>
</code></pre></div>
Since mixin classes are defined in the same way as normal classes, it is best to include the word “Mixin” as part of the class name. This naming convention provides a greater clarity of purpose.</p>
<p>To fully understand mixins, you need to know a bit more about how inheritance and the super() function work.</p>
<p>First, whenever you use inheritance, Python builds a linear chain of classes known as the Method Resolution Order, or MRO for short. This is available as the <strong>mro</strong> attribute on a class. Here are some examples for single inheritance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>    <span class="k">pass</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>    <span class="k">pass</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>    <span class="k">pass</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="n">Base</span><span class="o">.</span><span class="vm">__mro__</span> <span class="c1"># -&gt; (&lt;class &#39;Base&#39;&gt;, &lt;class &#39;object&#39;&gt;)</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="n">A</span><span class="o">.</span><span class="vm">__mro__</span>    <span class="c1"># -&gt; (&lt;class &#39;A&#39;&gt;, &lt;class &#39;Base&#39;&gt;, &lt;class &#39;object&#39;&gt;)</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="n">B</span><span class="o">.</span><span class="vm">__mro__</span>    <span class="c1"># -&gt; (&lt;class &#39;B&#39;&gt;, &lt;class &#39;A&#39;&gt;, &lt;class &#39;Base&#39;&gt;, &lt;class &#39;object&#39;&gt;)</span>
</code></pre></div>
<h3 id="cooperative-multiple-inheritence-and-mro">cooperative multiple inheritence and mro</h3>
<p>The MRO specifies the search order for attribute lookup. Specifically, whenever you search for an attribute on an instance or class, each class on the MRO is checked in the order listed. The search stops when the first match is made. The object class is listed in the MRO because all classes inherit from object, whether or not it’s listed as a parent.</p>
<p>To support multiple inheritance, Python implements what’s known as “cooperative multiple inheritance.” With cooperative inheritance, all of the classes are placed on the MRO list according to two primary ordering rules. The first rule states that a child class must always be checked before any of its parents. The second rule states that if a class has multiple parents, those parents must be checked in the same order as they’re written in the inheritance list of the child. For the most part, these rules produce an MRO that makes sense. However, the precise algorithm that orders the classes is actually quite complex and not based on any simple approach such as depth-first or breadth-first search. Instead, the ordering is determined according to the C3 linearization algorithm, which is described in the paper “A Monotonic Superclass Linearization for Dylan” (K. Barrett, et al., presented at OOPSLA’96). A subtle aspect of this algorithm is that certain class hierarchies will be rejected by Python with a TypeError. Here’s an example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">class</span> <span class="nc">X</span><span class="p">:</span> <span class="k">pass</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="k">class</span> <span class="nc">Y</span><span class="p">(</span><span class="n">X</span><span class="p">):</span> <span class="k">pass</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="k">class</span> <span class="nc">Z</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">):</span> <span class="k">pass</span>  <span class="c1"># TypeError.</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>                    <span class="c1"># Can&#39;t create consistent MRO</span>
</code></pre></div>
<p>In this case, the method resolution algorithm rejects class Z because it can’t determine an ordering of the base classes that makes sense. Here, the class X appears before class Y in the inheritance list, so it must be checked first. However, class Y inherits from X, so if X is checked first, it violates the rule about children being checked first. In practice, these issues rarely arise—and if they do, it usually indicates a more serious design problem.</p>
<p>As an example of an MRO in practice, here’s the MRO for the AnnoyingLoudCyclist class shown earlier:</p>
<h2 id="super">super ()</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="k">class</span> <span class="nc">AnnoyingLoudCyclist</span><span class="p">(</span><span class="n">AnnoyingMixin</span><span class="p">,</span> <span class="n">LoudMixin</span><span class="p">,</span> <span class="n">Cyclist</span><span class="p">):</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>    <span class="k">pass</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="n">AnnoyingLoudCyclist</span><span class="o">.</span><span class="vm">__mro__</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="c1"># (&lt;class &#39;AnnoyingLoudCyclist&#39;&gt;, &lt;class &#39;AnnoyingMixin&#39;&gt;,</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="c1"># &lt;class &#39;LoudMixin&#39;&gt;, &lt;class &#39;Cyclist&#39;&gt;, &lt;class &#39;object&#39;&gt;)</span>
</code></pre></div>
<p>In this MRO, you see how both rules are satisfied. Specifically, any child class is always listed before its parents. The object class is listed last because it is the parent of all other classes. The multiple parents are listed in the order they appeared in the code.</p>
<p>The behavior of the super() function is tied to the underlying MRO. Specifically, its role is to delegate attributes to the next class on the MRO. This is based upon the class where super() is used. For example, when the AnnoyingMixin class uses super(), it looks at the MRO of the instance to find its own position. From there, it delegates attribute lookup to the next class. In this example, using super().noise() in the AnnoyingMixin class invokes LoudMixin.noise(). This is because LoudMixin is the next class listed on the MRO for AnnoyingLoudCyclist. The super().noise() operation in the LoudMixin class then delegates to the Cyclist class. For any use of super(), the choice of the next class varies according to the type of the instance. For example, if you make an instance of AnnoyingTrombonist, then super().noise() will invoke Trombonist.noise() instead.</p>
<p>Designing for cooperative multiple inheritance and mixins is a challenge. Here are some design guidelines. First, child classes are always checked before any base class in the MRO. Thus, it is common for mixins to share a common parent, and for that parent to provide an empty implementation of methods. If multiple mixin classes are used at the same time, they’ll line up after each other. The common parent will appear last where it can provide a default implementation or an error check. For example:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">class</span> <span class="nc">NoiseMixin</span><span class="p">:</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;noise() not implemented&#39;</span><span class="p">)</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="k">class</span> <span class="nc">LoudMixin</span><span class="p">(</span><span class="n">NoiseMixin</span><span class="p">):</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="k">class</span> <span class="nc">AnnoyingMixin</span><span class="p">(</span><span class="n">NoiseMixin</span><span class="p">):</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>        <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span>
</code></pre></div>
The second guideline is that all implementations of a mixin method should have an identical function signature. One issue with mixins is that they are optional and often mixed together in unpredictable order. For this to work, you must guarantee that operations involving super() succeed regardless of what class comes next. To do that, all methods in the call chain need to have a compatible calling signature.</p>
<p>Finally, you need to make sure that you use super() everywhere. Sometimes you’ll encounter a class that makes a direct call to its parent:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>    <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Base.yow&#39;</span><span class="p">)</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>    <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.yow&#39;</span><span class="p">)</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a>        <span class="n">Base</span><span class="o">.</span><span class="n">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>       <span class="c1"># Direct call to parent</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>    <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B.yow&#39;</span><span class="p">)</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a>    <span class="k">pass</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="n">c</span><span class="o">.</span><span class="n">yow</span><span class="p">()</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="c1"># Outputs:</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="c1">#    A.yow</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a><span class="c1">#    Base.yow</span>
</code></pre></div>
Such classes are not safe to use with multiple inheritance. Doing so breaks the proper chain of method calls and causes confusion. For instance, in the above example, no output ever appears from B.yow() even though it’s part of the inheritance hierarchy. If you’re doing anything with multiple inheritance, you should be using super() instead of making direct calls to methods in superclasses.</p>
<h2 id="type-based-dispach">type based dispach</h2>
<p>Sometimes you need to write code that dispatches based on a specific type. For example:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Duck</span><span class="p">):</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>   <span class="n">handle_duck</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Trombonist</span><span class="p">):</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>   <span class="n">handle_trombonist</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Cyclist</span><span class="p">):</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>   <span class="n">handle_cyclist</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>   <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unknown object&#39;</span><span class="p">)</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="n">Such</span> <span class="n">a</span> <span class="n">large</span> <span class="k">if</span><span class="o">-</span><span class="k">elif</span><span class="o">-</span><span class="k">else</span> <span class="n">block</span> <span class="ow">is</span> <span class="n">inelegant</span> <span class="ow">and</span> <span class="n">fragile</span><span class="o">.</span> <span class="n">An</span> <span class="n">often</span> <span class="n">used</span> <span class="n">solution</span> <span class="ow">is</span> <span class="n">to</span> <span class="n">dispatch</span> <span class="n">through</span> <span class="n">a</span> <span class="n">dictionary</span><span class="p">:</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="n">Click</span> <span class="n">here</span> <span class="n">to</span> <span class="n">view</span> <span class="n">code</span> <span class="n">image</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="n">handlers</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>    <span class="n">Duck</span><span class="p">:</span> <span class="n">handle_duck</span><span class="p">,</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a>    <span class="n">Trombonist</span><span class="p">:</span> <span class="n">handle_trombonist</span><span class="p">,</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>    <span class="n">Cyclist</span><span class="p">:</span> <span class="n">handle_cyclist</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="p">}</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="c1"># Dispatch</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a>    <span class="n">func</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a>    <span class="k">if</span> <span class="n">func</span><span class="p">:</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a>         <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No handler for </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
This solution assumes an exact type match. If inheritance is also to be supported in such dispatch, you would need to walk the MRO:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>    <span class="k">for</span> <span class="n">ty</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>        <span class="n">func</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ty</span><span class="p">)</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>        <span class="k">if</span> <span class="n">func</span><span class="p">:</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a>    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No handler for </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
Sometimes dispatching is implemented through a class-based interface using getattr() like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="k">class</span> <span class="nc">Dispatcher</span><span class="p">:</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>        <span class="k">for</span> <span class="n">ty</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>            <span class="n">meth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;handle_</span><span class="si">{</span><span class="n">ty</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>            <span class="k">if</span> <span class="n">meth</span><span class="p">:</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a>                <span class="k">return</span> <span class="n">meth</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No handler for </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a>    <span class="k">def</span> <span class="nf">handle_Duck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a>        <span class="o">...</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a>    <span class="k">def</span> <span class="nf">handle_Trombonist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a>        <span class="o">...</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a>    <span class="k">def</span> <span class="nf">handle_Cyclist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a>        <span class="o">...</span>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="c1"># Example</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><span class="n">dispatcher</span> <span class="o">=</span> <span class="n">Dispatcher</span><span class="p">()</span>
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><span class="n">dispatcher</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">Duck</span><span class="p">())</span>     <span class="c1"># -&gt; handle_Duck()</span>
<a id="__codelineno-25-21" name="__codelineno-25-21"></a><span class="n">dispatcher</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">Cyclist</span><span class="p">())</span>  <span class="c1"># -&gt; handle_Cyclist()</span>
</code></pre></div>
<h2 id="class-decorators">class decorators</h2>
<p>Sometimes you want to perform extra processing steps after a class has been defined—such as adding the class to a registry or generating extra support code. One approach is to use a class decorator. A class decorator is a function that takes a class as input and returns a class as output. For example, here’s how you can maintain a registry:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="n">_registry</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="k">def</span> <span class="nf">register_decoder</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a>    <span class="k">for</span> <span class="n">mt</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mimetypes</span><span class="p">:</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>        <span class="n">_registry</span><span class="p">[</span><span class="n">mt</span><span class="o">.</span><span class="n">mimetype</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>    <span class="k">return</span> <span class="bp">cls</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="c1"># Factory function that uses the registry</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="k">def</span> <span class="nf">create_decoder</span><span class="p">(</span><span class="n">mimetype</span><span class="p">):</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>    <span class="k">return</span> <span class="n">_registry</span><span class="p">[</span><span class="n">mimetype</span><span class="p">]()</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="nd">@register_decoder</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="k">class</span> <span class="nc">TextDecoder</span><span class="p">:</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;text/plain&#39;</span> <span class="p">]</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a>        <span class="o">...</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="nd">@register_decoder</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="k">class</span> <span class="nc">HTMLDecoder</span><span class="p">:</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;text/html&#39;</span> <span class="p">]</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a>        <span class="o">...</span>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a>
<a id="__codelineno-26-23" name="__codelineno-26-23"></a><span class="nd">@register_decoder</span>
<a id="__codelineno-26-24" name="__codelineno-26-24"></a><span class="k">class</span> <span class="nc">ImageDecoder</span><span class="p">:</span>
<a id="__codelineno-26-25" name="__codelineno-26-25"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span> <span class="s1">&#39;image/jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;image/gif&#39;</span> <span class="p">]</span>
<a id="__codelineno-26-26" name="__codelineno-26-26"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-26-27" name="__codelineno-26-27"></a>        <span class="o">...</span>
<a id="__codelineno-26-28" name="__codelineno-26-28"></a>
<a id="__codelineno-26-29" name="__codelineno-26-29"></a><span class="c1"># Example usage</span>
<a id="__codelineno-26-30" name="__codelineno-26-30"></a><span class="n">decoder</span> <span class="o">=</span> <span class="n">create_decoder</span><span class="p">(</span><span class="s1">&#39;image/jpg&#39;</span><span class="p">)</span>
</code></pre></div>
<p>A class decorator is free to modify the contents of the class it’s given. For example, it might even rewrite existing methods. This is a common alternative to mixin classes or multiple inheritance. For example, consider these decorators:</p>
<h2 id="class-decorator-oveerride-function">class decorator oveerride function</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="k">def</span> <span class="nf">loud</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>    <span class="n">orig_noise</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">noise</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>        <span class="k">return</span> <span class="n">orig_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a>    <span class="bp">cls</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a>    <span class="k">return</span> <span class="bp">cls</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="k">def</span> <span class="nf">annoying</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a>    <span class="n">orig_noise</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">noise</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a>        <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">orig_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a>    <span class="bp">cls</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a>    <span class="k">return</span> <span class="bp">cls</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="nd">@annoying</span>
<a id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="nd">@loud</span>
<a id="__codelineno-27-17" name="__codelineno-27-17"></a><span class="k">class</span> <span class="nc">Cyclist</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-27-18" name="__codelineno-27-18"></a>    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-27-19" name="__codelineno-27-19"></a>        <span class="k">return</span> <span class="s1">&#39;On your left!&#39;</span>
<a id="__codelineno-27-20" name="__codelineno-27-20"></a>
<a id="__codelineno-27-21" name="__codelineno-27-21"></a>    <span class="k">def</span> <span class="nf">pedal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-27-22" name="__codelineno-27-22"></a>        <span class="k">return</span> <span class="s1">&#39;Pedaling&#39;</span>
</code></pre></div>
<h2 id="add-code-to-class-at-runtime">add code  to class at runtime</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="si">!r}</span><span class="s1">)&#39;</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="n">Writing</span> <span class="n">such</span> <span class="n">methods</span> <span class="ow">is</span> <span class="n">often</span> <span class="n">annoying</span><span class="o">.</span> <span class="n">Perhaps</span> <span class="n">a</span> <span class="k">class</span> <span class="nc">decorator</span> <span class="n">could</span> <span class="n">create</span> <span class="n">the</span> <span class="n">method</span> <span class="k">for</span> <span class="n">you</span><span class="err">?</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="n">Click</span> <span class="n">here</span> <span class="n">to</span> <span class="n">view</span> <span class="n">code</span> <span class="n">image</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="kn">import</span> <span class="nn">inspect</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="k">def</span> <span class="nf">with_repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a>    <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a>    <span class="n">argvals</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;{self.</span><span class="si">%s</span><span class="s1">!r}&#39;</span> <span class="o">%</span> <span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a>    <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;def __repr__(self):</span><span class="se">\n</span><span class="s1">&#39;</span>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a>    <span class="n">code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; return f&#39;</span><span class="p">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">}({</span><span class="n">argvals</span><span class="p">})</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a>    <span class="n">locs</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<a id="__codelineno-28-19" name="__codelineno-28-19"></a>    <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">locs</span><span class="p">)</span>
<a id="__codelineno-28-20" name="__codelineno-28-20"></a>    <span class="bp">cls</span><span class="o">.</span><span class="fm">__repr__</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="s1">&#39;__repr__&#39;</span><span class="p">]</span>
<a id="__codelineno-28-21" name="__codelineno-28-21"></a>    <span class="k">return</span> <span class="bp">cls</span>
<a id="__codelineno-28-22" name="__codelineno-28-22"></a>
<a id="__codelineno-28-23" name="__codelineno-28-23"></a><span class="c1"># Example</span>
<a id="__codelineno-28-24" name="__codelineno-28-24"></a><span class="nd">@with_repr</span>
<a id="__codelineno-28-25" name="__codelineno-28-25"></a><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
<a id="__codelineno-28-26" name="__codelineno-28-26"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-28-27" name="__codelineno-28-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-28-28" name="__codelineno-28-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
</code></pre></div>
<p>In this example, a <strong>repr</strong>() method is generated from the calling signature of the <strong>init</strong>() method. The method is created as a text string and passed to exec() to create a function. That function is attached to the class.</p>
<p>Similar code generation techniques are used in parts of the standard library. For example, a convenient way to define data structures is to use a dataclass:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="nd">@dataclass</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a>    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a>    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="n">A</span> <span class="n">dataclass</span> <span class="n">automatically</span> <span class="n">creates</span> <span class="n">methods</span> <span class="n">such</span> <span class="k">as</span> <span class="fm">__init__</span><span class="p">()</span> <span class="ow">and</span> <span class="fm">__repr__</span><span class="p">()</span> <span class="kn">from</span> <span class="nn">class</span> <span class="nb">type</span> <span class="n">hints</span><span class="o">.</span> <span class="n">The</span> <span class="n">methods</span> <span class="n">are</span> <span class="n">created</span> <span class="n">using</span> <span class="n">exec</span><span class="p">(),</span> <span class="n">similarly</span> <span class="n">to</span> <span class="n">the</span> <span class="n">prior</span> <span class="n">example</span><span class="o">.</span> <span class="n">Here</span><span class="err">’</span><span class="n">s</span> <span class="n">how</span> <span class="n">the</span> <span class="n">resulting</span> <span class="n">Point</span> <span class="k">class</span> <span class="nc">works</span><span class="p">:</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="n">Click</span> <span class="n">here</span> <span class="n">to</span> <span class="n">view</span> <span class="n">code</span> <span class="n">image</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a>
<a id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">p</span>
<a id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="o">&gt;&gt;&gt;</span>
</code></pre></div>
One downside of such an approach is poor startup performance. Dynamically creating code with exec() bypasses the compilation optimizations that Python normally applies to modules. Defining a large number of classes in this way may therefore significantly slow down the importing of your code.</p>
<h2 id="supervised-inheritence-init-subclass">supervised inheritence - init subclass</h2>
<p>As you saw in the previous section, sometimes you want to define a class and perform additional actions. A class decorator is one mechanism for doing this. However, a parent class can also perform extra actions on behalf of its subclasses. This is accomplished by implementing an <strong>init_subclass</strong>(cls) class method. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initializing&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="c1"># Example (should see &#39;Initializing&#39; message for each class)</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a>    <span class="k">pass</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a>    <span class="k">pass</span>
</code></pre></div>
<p>If an <strong>init_subclass</strong>() method is present, it is triggered automatically upon the definition of any child class. This happens even if the child is buried deeply in an inheritance hierarchy.</p>
<p>Many of the tasks commonly performed with class decorators can be performed with <strong>init_subclass</strong>() instead. For example, class registration:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="k">class</span> <span class="nc">DecoderBase</span><span class="p">:</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>    <span class="n">_registry</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>        <span class="k">for</span> <span class="n">mt</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mimetypes</span><span class="p">:</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a>            <span class="n">DecoderBase</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">mt</span><span class="o">.</span><span class="n">mimetype</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="c1"># Factory function that uses the registry</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="k">def</span> <span class="nf">create_decoder</span><span class="p">(</span><span class="n">mimetype</span><span class="p">):</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a>    <span class="k">return</span> <span class="n">DecoderBase</span><span class="o">.</span><span class="n">_registry</span><span class="p">[</span><span class="n">mimetype</span><span class="p">]()</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="k">class</span> <span class="nc">TextDecoder</span><span class="p">(</span><span class="n">DecoderBase</span><span class="p">):</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;text/plain&#39;</span> <span class="p">]</span>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a>        <span class="o">...</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="k">class</span> <span class="nc">HTMLDecoder</span><span class="p">(</span><span class="n">DecoderBase</span><span class="p">):</span>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;text/html&#39;</span> <span class="p">]</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-31-20" name="__codelineno-31-20"></a>        <span class="o">...</span>
<a id="__codelineno-31-21" name="__codelineno-31-21"></a>
<a id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="k">class</span> <span class="nc">ImageDecoder</span><span class="p">(</span><span class="n">DecoderBase</span><span class="p">):</span>
<a id="__codelineno-31-23" name="__codelineno-31-23"></a>    <span class="n">mimetypes</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span> <span class="s1">&#39;image/jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;image/gif&#39;</span> <span class="p">]</span>
<a id="__codelineno-31-24" name="__codelineno-31-24"></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-31-25" name="__codelineno-31-25"></a>        <span class="o">...</span>
<a id="__codelineno-31-26" name="__codelineno-31-26"></a>
<a id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="c1"># Example usage</span>
<a id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="n">decoder</span> <span class="o">=</span> <span class="n">create_decoder</span><span class="p">(</span><span class="s1">&#39;image/jpg&#39;</span><span class="p">)</span>
</code></pre></div>
add reps
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kn">import</span> <span class="nn">inspect</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>        <span class="c1"># Create a __repr__ method</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a>        <span class="n">argvals</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;{self.</span><span class="si">%s</span><span class="s1">!r}&#39;</span> <span class="o">%</span> <span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>        <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;def __repr__(self):</span><span class="se">\n</span><span class="s1">&#39;</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a>        <span class="n">code</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; return f&#39;</span><span class="p">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">}({</span><span class="n">argvals</span><span class="p">})</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a>        <span class="n">locs</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a>        <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">locs</span><span class="p">)</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a>        <span class="bp">cls</span><span class="o">.</span><span class="fm">__repr__</span> <span class="o">=</span> <span class="n">locs</span><span class="p">[</span><span class="s1">&#39;__repr__&#39;</span><span class="p">]</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-32-17" name="__codelineno-32-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
</code></pre></div></p>
<p>If multiple inheritance is being used, you should use super() to make sure all classes that implement <strong>init_subclass</strong>() get called. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a>    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.init_subclass&#39;</span><span class="p">)</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">()</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a>    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B.init_subclass&#39;</span><span class="p">)</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">()</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="c1"># Should see output from both classes here</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a>    <span class="k">pass</span>
</code></pre></div>
<h2 id="object-life-cycle-and-memory-management">object life cycle and memory management</h2>
<p>When a class is defined, the resulting class is a factory for creating new instances. For example:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="c1"># Create some Account instances</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="n">b</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Eva&#39;</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">)</span>
</code></pre></div>
The creation of an instance is carried out in two steps using the special method <strong>new</strong>() that creates a new instance and <strong>init</strong>() that initializes it. For example, the operation a = Account('Guido', 1000.0) performs these steps:
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a>a = Account.__new__(Account, &#39;Guido&#39;, 1000.0)
<a id="__codelineno-35-2" name="__codelineno-35-2"></a>if isinstance(a, Account):
<a id="__codelineno-35-3" name="__codelineno-35-3"></a>    Account.__init__(&#39;Guido&#39;, 1000.0)
</code></pre></div>
Except for the first argument which is the class instead of an instance, <strong>new</strong>() normally receives the same arguments as <strong>init</strong>(). However, the default implementation of <strong>new</strong>() just ignores them. You’ll sometimes see <strong>new</strong>() invoked with just a single argument. For example, this code also works:</p>
<p>Direct use of the <strong>new</strong>() method is uncommon, but sometimes it’s used to create instances while bypassing the invocation of the <strong>init</strong>() method. One such use is in class methods. For example:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="k">class</span> <span class="nc">Date</span><span class="p">:</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">month</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">day</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a>    <span class="k">def</span> <span class="nf">today</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>   <span class="c1"># Make instance</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tm_year</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tm_month</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tm_day</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a>        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
Modules that perform object serialization such as pickle also utilize <strong>new</strong>() to recreate instances when objects are deserialized. This is done without ever invoking <strong>init</strong>().</p>
<p>Sometimes a class will define <strong>new</strong>() if it wants to alter some aspect of instance creation. Typical applications include instance caching, singletons, and immutability. As an example, you might want Date class to perform date interning—that is, caching and reusing Date instances that have an identical year, month, and day. Here is one way that might be implemented:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="k">class</span> <span class="nc">Date</span><span class="p">:</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a>    <span class="n">_cache</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a>        <span class="bp">self</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">))</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a>            <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">month</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">day</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a>            <span class="n">Date</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a>
<a id="__codelineno-37-15" name="__codelineno-37-15"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a>        <span class="k">pass</span>
</code></pre></div>
<p>In this example, the class keeps an internal dictionary of previously created Date instances. When creating a new Date, the cache is consulted first. If a match is found, that instance is returned. Otherwise, a new instance is created and initialized.</p>
<p>A subtle detail of this solution is the empty <strong>init</strong>() method. Even though instances are cached, every call to Date() still invokes <strong>init</strong>(). To avoid duplicated effort, the method simply does nothing—instance creation actually takes place in <strong>new</strong>() when an instance is created the first time.</p>
<p>There are ways to avoid the extra call to <strong>init</strong>() but it requires sneaky tricks. One way to avoid it is to have <strong>new</strong>() return an entirely different type instance—for example, one belonging to a different class. Another solution, described later, is to use a metaclass.</p>
<p>Once created, instances are managed by reference counting. If the reference count reaches zero, the instance is immediately destroyed. When the instance is about to be destroyed, the interpreter first looks for a <strong>del</strong>() method associated with the object and calls it. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Deleting Account&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Occasionally, a program will use the del statement to delete a reference to an object as shown. If this causes the reference count of the object to reach zero, the <strong>del</strong>() method is called. However, in general, the del statement doesn’t directly call <strong>del</strong>() because there may be other object references living elsewhere. There are many other ways that an object might be deleted—for example, reassignment of a variable name or a variable going out of scope in a function:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">42</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="n">Deleting</span> <span class="n">Account</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="o">...</span>     <span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="o">...</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">func</span><span class="p">()</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="n">Deleting</span> <span class="n">Account</span>
</code></pre></div>
In practice, it’s rarely necessary for a class to define a <strong>del</strong>() method. The only exception is when the destruction of an object requires an extra cleanup action—such as closing a file, shutting down a network connection, or releasing other system resources. Even in these cases, it’s dangerous to rely on <strong>del</strong>() for a proper shutdown because there’s no guarantee that this method will be called when you think it would. For clean shutdown of resources, you should give the object an explicit close() method. You should also make your class support the context manager protocol so it can be used with the with statement. Here is an example that covers all of the cases:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">open_resource</span><span class="p">()</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a>
<a id="__codelineno-40-17" name="__codelineno-40-17"></a><span class="c1"># Closed via __del__()</span>
<a id="__codelineno-40-18" name="__codelineno-40-18"></a><span class="n">s</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<a id="__codelineno-40-19" name="__codelineno-40-19"></a><span class="k">del</span> <span class="n">s</span>
<a id="__codelineno-40-20" name="__codelineno-40-20"></a>
<a id="__codelineno-40-21" name="__codelineno-40-21"></a><span class="c1"># Explicit close</span>
<a id="__codelineno-40-22" name="__codelineno-40-22"></a><span class="n">s</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<a id="__codelineno-40-23" name="__codelineno-40-23"></a><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-40-24" name="__codelineno-40-24"></a>
<a id="__codelineno-40-25" name="__codelineno-40-25"></a><span class="c1"># Closed at the end of a context block</span>
<a id="__codelineno-40-26" name="__codelineno-40-26"></a><span class="k">with</span> <span class="n">SomeClass</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
</code></pre></div>
<p>Again, it should be emphasized that writing a <strong>del</strong>() in a class is almost never necessary. Python already has garbage collection and there is simply no need to do it unless there is some extra action that needs to take place upon object destruction. Even then, you still might not need <strong>del</strong>() as it’s possible that the object is already programmed to clean itself up properly even if you do nothing.</p>
<p>As if there weren’t enough dangers with reference counting and object destruction, there are certain kinds of programming patterns—especially those involving parent-child relationships, graphs, or caching—where objects can create a so-called reference cycle. Here is an example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Deleting&#39;</span><span class="p">)</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="n">parent</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="n">child</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="c1"># Create a child-parent reference cycle</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="n">parent</span><span class="o">.</span><span class="n">child</span> <span class="o">=</span> <span class="n">child</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="n">child</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="c1"># Try deletion (no output from __del__ appears)</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="k">del</span> <span class="n">parent</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="k">del</span> <span class="n">child</span>
</code></pre></div>
<p>In this example, the variable names are destroyed but you never see execution of the <strong>del</strong>() method. The two objects each hold internal references to each other, so there’s no way for the reference count to ever drop to 0. To handle this, a special cycle-detecting garbage collector runs every so often. Eventually the objects will be reclaimed, but it’s hard to predict when this might happen. If you want to force garbage collection, you can call gc.collect(). The gc module has a variety of other functions related to the cyclic garbage collector and monitoring memory.</p>
<p>Because of the unpredictable timing of garbage collection, the <strong>del</strong>() method has a few restrictions placed on it. First, any exception that propagates out of <strong>del</strong>() is printed to sys.stderr, but otherwise ignored. Second, the <strong>del</strong>() method should avoid operations such as acquiring locks or other resources. Doing so could result in a deadlock when <strong>del</strong>() is unexpectedly fired in the middle of executing an unrelated function within the seventh inner callback circle of signal handling and threads. If you must define <strong>del</strong>(), keep it simple.</p>
<h2 id="weak-references">weak references</h2>
<p>Sometimes objects are kept alive when you’d much rather see them die. In an earlier example, a Date class was shown with internal caching of instances. One problem with this implementation is that there is no way for an instance to ever be removed from the cache. As such, the cache will grow larger and larger over time.</p>
<p>One way to fix this problem is to create a weak reference using the weakref module. A weak reference is a way of creating a reference to an object without increasing its reference count. To work with a weak reference, you have to add an extra bit of code to check if the object being referred to still exists. Here’s an example of how you create a weakref:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">weakref</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a_ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a_ref</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="o">&lt;</span><span class="n">weakref</span> <span class="n">at</span> <span class="mh">0x104617188</span><span class="p">;</span> <span class="n">to</span> <span class="s1">&#39;Account&#39;</span> <span class="n">at</span> <span class="mh">0x1046105c0</span><span class="o">&gt;</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="o">&gt;&gt;&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="kn">import</span> <span class="nn">weakref</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="k">class</span> <span class="nc">Date</span><span class="p">:</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a>    <span class="n">_cache</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a>        <span class="n">selfref</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">))</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">selfref</span><span class="p">:</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a>            <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">=</span> <span class="n">month</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">day</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a>            <span class="n">Date</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a>            <span class="bp">self</span> <span class="o">=</span> <span class="n">selfref</span><span class="p">()</span>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
<a id="__codelineno-43-20" name="__codelineno-43-20"></a>        <span class="k">pass</span>
<a id="__codelineno-43-21" name="__codelineno-43-21"></a>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-43-23" name="__codelineno-43-23"></a>        <span class="k">del</span> <span class="n">Date</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">]</span>
</code></pre></div></p>
<p>This might require a bit of study, but here is an interactive session that shows how it works. Notice how an entry is removed from the cache once no more references to it exist</p>
<p>Support for weak references requires instances to have a mutable <strong>weakref</strong> attribute. Instances of user-defined classes normally have such an attribute by default. However, built-in types and certain kinds of special data structures—named tuples, classes with slots—do not. If you want to construct weak references to these types, you can do it by defining variants with a <strong>weakref</strong> attribute added:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="k">class</span> <span class="nc">wdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;__weakref__&#39;</span><span class="p">,)</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="n">w</span> <span class="o">=</span> <span class="n">wdict</span><span class="p">()</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="n">w_ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>      <span class="c1"># Now works</span>
</code></pre></div>
<h2 id="attribute-binding">attribute binding</h2>
<p>The state associated with an instance is stored in a dictionary that’s accessible as the instance’s <strong>dict</strong> attribute. This dictionary contains the data that’s unique to each instance. Here’s an example:</p>
<p>a.<strong>dict</strong></p>
<p>a.number = 123456 # Add attribute 'number' to a.<strong>dict</strong>
a.<strong>dict</strong>['number'] = 654321
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="o">.</span><span class="vm">__class__</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">Account</span><span class="s1">&#39;&gt;</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">Account</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;__module__&#39;</span><span class="p">,</span> <span class="s1">&#39;__init__&#39;</span><span class="p">,</span> <span class="s1">&#39;__repr__&#39;</span><span class="p">,</span> <span class="s1">&#39;deposit&#39;</span><span class="p">,</span> <span class="s1">&#39;withdraw&#39;</span><span class="p">,</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="s1">&#39;inquiry&#39;</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">,</span> <span class="s1">&#39;__weakref__&#39;</span><span class="p">,</span> <span class="s1">&#39;__doc__&#39;</span><span class="p">])</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">Account</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;withdraw&#39;</span><span class="p">]</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="o">&lt;</span><span class="n">function</span> <span class="n">Account</span><span class="o">.</span><span class="n">withdraw</span> <span class="n">at</span> <span class="mh">0x108204158</span><span class="o">&gt;</span>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="o">&gt;&gt;&gt;</span>
</code></pre></div></p>
<p>Classes are linked to their base classes by a special attribute <strong>bases</strong>, which is a tuple of the base classes. The <strong>bases</strong> attribute is only informational. The actual runtime implementation of inheritance uses the <strong>mro</strong> attribute which is a tuple of all parent classes listed in search order. This underlying structure is the basis for all operations that get, set, or delete the attributes of instances.</p>
<p>Whenever an attribute is set using obj.name = value, the special method obj.<strong>setattr</strong>('name', value) is invoked. If an attribute is deleted using del obj.name, the special method obj.<strong>delattr</strong>('name') is invoked. The default behavior of these methods is to modify or remove values from the local <strong>dict</strong> of obj unless the requested attribute happens to correspond to a property or descriptor. In that case, the set and delete operations will be carried out by the set and delete functions associated with the property.</p>
<p>For attribute lookup such as obj.name, the special method obj.<strong>getattribute</strong>('name') is invoked. This method carries out the search for the attribute, which normally includes checking the properties, looking in the local <strong>dict</strong>, checking the class dictionary, and searching the MRO. If this search fails, a final attempt to find the attribute is made by invoking the obj.<strong>getattr</strong>('name') method of the class (if defined). If this fails, an AttributeError exception is raised.</p>
<p>User-defined classes can implement their own versions of the attribute access functions, if desired. For example, here’s a class that restricts the attribute names that can be set:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a>    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;owner&#39;</span><span class="p">,</span> <span class="s1">&#39;balance&#39;</span><span class="p">}:</span>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No attribute </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-46-10" name="__codelineno-46-10"></a>
<a id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="c1"># Example</span>
<a id="__codelineno-46-12" name="__codelineno-46-12"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a><span class="n">a</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="mf">940.25</span>          <span class="c1"># Ok</span>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a><span class="n">a</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="mf">540.2</span>            <span class="c1"># AttributeError. No attribute amount</span>
</code></pre></div>
<h2 id="proxies-wrappers-delegations">proxies, wrappers, delegations</h2>
<p>A common implementation technique for proxies involves the <strong>getattr</strong>() method. Here is a simple example:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a>    <span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.spam&#39;</span><span class="p">)</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a>    <span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.grok&#39;</span><span class="p">)</span>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a>    <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.yow&#39;</span><span class="p">)</span>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><span class="k">class</span> <span class="nc">LoggedA</span><span class="p">:</span>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-47-13" name="__codelineno-47-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a>
<a id="__codelineno-47-15" name="__codelineno-47-15"></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-47-16" name="__codelineno-47-16"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accessing&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-47-17" name="__codelineno-47-17"></a>        <span class="c1"># Delegate to internal A instance</span>
<a id="__codelineno-47-18" name="__codelineno-47-18"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-47-19" name="__codelineno-47-19"></a>
<a id="__codelineno-47-20" name="__codelineno-47-20"></a><span class="c1"># Example use</span>
<a id="__codelineno-47-21" name="__codelineno-47-21"></a><span class="n">a</span> <span class="o">=</span> <span class="n">LoggedA</span><span class="p">()</span>
<a id="__codelineno-47-22" name="__codelineno-47-22"></a><span class="n">a</span><span class="o">.</span><span class="n">spam</span><span class="p">()</span>       <span class="c1"># prints &#39;Accessing spam&#39; and &#39;A.spam&#39;</span>
<a id="__codelineno-47-23" name="__codelineno-47-23"></a><span class="n">a</span><span class="o">.</span><span class="n">yow</span><span class="p">()</span>        <span class="c1"># prints &#39;Accessing yow&#39; and &#39;A.yow&#39;</span>
</code></pre></div>
Delegation is sometimes used as an alternative to inheritance. Here is an example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a>    <span class="k">def</span> <span class="nf">spam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.spam&#39;</span><span class="p">)</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a>    <span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.grok&#39;</span><span class="p">)</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a>    <span class="k">def</span> <span class="nf">yow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;A.yow&#39;</span><span class="p">)</span>
<a id="__codelineno-48-10" name="__codelineno-48-10"></a>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a><span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
<a id="__codelineno-48-12" name="__codelineno-48-12"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-48-13" name="__codelineno-48-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<a id="__codelineno-48-14" name="__codelineno-48-14"></a>
<a id="__codelineno-48-15" name="__codelineno-48-15"></a>    <span class="k">def</span> <span class="nf">grok</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-48-16" name="__codelineno-48-16"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B.grok&#39;</span><span class="p">)</span>
<a id="__codelineno-48-17" name="__codelineno-48-17"></a>
<a id="__codelineno-48-18" name="__codelineno-48-18"></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-48-19" name="__codelineno-48-19"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-48-20" name="__codelineno-48-20"></a>
<a id="__codelineno-48-21" name="__codelineno-48-21"></a><span class="c1"># Example use</span>
<a id="__codelineno-48-22" name="__codelineno-48-22"></a><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<a id="__codelineno-48-23" name="__codelineno-48-23"></a><span class="n">b</span><span class="o">.</span><span class="n">spam</span><span class="p">()</span>      <span class="c1"># -&gt; A.spam</span>
<a id="__codelineno-48-24" name="__codelineno-48-24"></a><span class="n">b</span><span class="o">.</span><span class="n">grok</span><span class="p">()</span>      <span class="c1"># -&gt; B.grok   (redefined method)</span>
<a id="__codelineno-48-25" name="__codelineno-48-25"></a><span class="n">b</span><span class="o">.</span><span class="n">yow</span><span class="p">()</span>       <span class="c1"># -&gt; A.yow</span>
</code></pre></div>
<p>n this example, it appears as if class B might be inheriting from class A and redefining a single method. This is the observed behavior—but inheritance is not being used. Instead, B holds an internal reference to an A inside. Certain methods of A can be redefined. However, all of the other methods are delegated via the <strong>getattr</strong>() method.</p>
<p>The technique of forwarding attribute lookup via <strong>getattr</strong>() is a common technique. However, be aware that it does not apply to operations mapped to special methods. For example, consider this class:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="k">class</span> <span class="nc">ListLike</span><span class="p">:</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="c1"># Example</span>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="n">a</span> <span class="o">=</span> <span class="n">ListLike</span><span class="p">()</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a><span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>         <span class="c1"># Works</span>
<a id="__codelineno-49-11" name="__codelineno-49-11"></a><span class="n">a</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>      <span class="c1"># Works</span>
<a id="__codelineno-49-12" name="__codelineno-49-12"></a><span class="n">a</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>            <span class="c1"># Works</span>
<a id="__codelineno-49-13" name="__codelineno-49-13"></a>
<a id="__codelineno-49-14" name="__codelineno-49-14"></a><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>              <span class="c1"># Fails. No __len__() method</span>
<a id="__codelineno-49-15" name="__codelineno-49-15"></a><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                <span class="c1"># Fails. No __getitem__() method</span>
</code></pre></div>
<p>Here, the class successfully forwards all of the standard list methods (list.sort(), list.append(), and so on) to an inner list. However, none of Python’s standard operators work. To make those work, you would have to explicitly implement the required special methods. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="k">class</span> <span class="nc">ListLike</span><span class="p">:</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-50-9" name="__codelineno-50-9"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">)</span>
<a id="__codelineno-50-10" name="__codelineno-50-10"></a>
<a id="__codelineno-50-11" name="__codelineno-50-11"></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<a id="__codelineno-50-12" name="__codelineno-50-12"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-50-13" name="__codelineno-50-13"></a>
<a id="__codelineno-50-14" name="__codelineno-50-14"></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-50-15" name="__codelineno-50-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div>
<h2 id="slots"><strong>slots</strong></h2>
<p>class Account(object):
    <strong>slots</strong> = ('owner', 'balance')
      ...
Slots is a definition hint that allows Python to make performance optimizations for both memory use and execution speed. Instances of a class with <strong>slots</strong> no longer use a dictionary for storing instance data. Instead, a much more compact data structure based on an array is used. In programs that create a large number of objects, using <strong>slots</strong> can result in a substantial reduction in memory use and a modest improvement in execution time.</p>
<p>The only entries in <strong>slots</strong> are instance attributes. You do not list methods, properties, class variables, or any other class-level attributes. Basically, it’s the same names that would ordinarily appear as dictionary keys in the instance’s <strong>dict</strong>.</p>
<p>Be aware that <strong>slots</strong> has a tricky interaction with inheritance. If a class inherits from a base class that uses <strong>slots</strong>, it also needs to define <strong>slots</strong> for storing its own attributes (even if it doesn’t add any) to take advantage of the benefits <strong>slots</strong> provides. If you forget this, the derived class will run slower—and use even more memory than if <strong>slots</strong> had not been used on any of the classes!</p>
<p><strong>slots</strong> is incompatible with multiple inheritance. If multiple base classes are specified, each with nonempty slots, you will get a TypeError.</p>
<p>The use of <strong>slots</strong> can also break code that expects instances to have an underlying <strong>dict</strong> attribute. Although this often does not apply to user code, utility libraries and other tools for supporting objects may be programmed to look at <strong>dict</strong> for debugging, serializing objects, and other operations.</p>
<p>The presence of <strong>slots</strong> has no effect on the invocation of methods such as <strong>getattribute</strong>(), <strong>getattr</strong>(), and <strong>setattr</strong>() should they be redefined in a class. However, if you’re implementing such methods, be aware that there is no longer any instance <strong>dict</strong> attribute. Your implementation will need to take that into account.</p>
<h2 id="descriptors">Descriptors</h2>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a>Normally, attribute access corresponds to dictionary operations. If more control is needed, attribute access can be routed through user-defined get, set, and delete functions. The use of properties was already described. However, a property is actually implemented using a lower-level construct known as a descriptor. A descriptor is a class-level object that manages access to an attribute. By implementing one or more of the special methods __get__(), __set__(), and __delete__(), you can hook directly into the attribute access mechanism and customize those operations. Here is an example:
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="k">class</span> <span class="nc">Typed</span><span class="p">:</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">object</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a>    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a>        <span class="k">if</span> <span class="n">instance</span><span class="p">:</span>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a>            <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-52-10" name="__codelineno-52-10"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-52-11" name="__codelineno-52-11"></a>            <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-52-12" name="__codelineno-52-12"></a>
<a id="__codelineno-52-13" name="__codelineno-52-13"></a>    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-52-14" name="__codelineno-52-14"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_type</span><span class="p">):</span>
<a id="__codelineno-52-15" name="__codelineno-52-15"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-52-16" name="__codelineno-52-16"></a>        <span class="n">instance</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-52-17" name="__codelineno-52-17"></a>
<a id="__codelineno-52-18" name="__codelineno-52-18"></a>    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">instance</span><span class="p">):</span>
<a id="__codelineno-52-19" name="__codelineno-52-19"></a>        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Can&#39;</span><span class="n">t</span> <span class="n">delete</span> <span class="n">attribute</span><span class="s1">&#39;)</span>
<a id="__codelineno-52-20" name="__codelineno-52-20"></a>
<a id="__codelineno-52-21" name="__codelineno-52-21"></a>
<a id="__codelineno-52-22" name="__codelineno-52-22"></a><span class="k">class</span> <span class="nc">Integer</span><span class="p">(</span><span class="n">Typed</span><span class="p">):</span>
<a id="__codelineno-52-23" name="__codelineno-52-23"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">int</span>
<a id="__codelineno-52-24" name="__codelineno-52-24"></a>
<a id="__codelineno-52-25" name="__codelineno-52-25"></a><span class="k">class</span> <span class="nc">Float</span><span class="p">(</span><span class="n">Typed</span><span class="p">):</span>
<a id="__codelineno-52-26" name="__codelineno-52-26"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">float</span>
<a id="__codelineno-52-27" name="__codelineno-52-27"></a>
<a id="__codelineno-52-28" name="__codelineno-52-28"></a><span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="n">Typed</span><span class="p">):</span>
<a id="__codelineno-52-29" name="__codelineno-52-29"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">str</span>
<a id="__codelineno-52-30" name="__codelineno-52-30"></a>
<a id="__codelineno-52-31" name="__codelineno-52-31"></a><span class="c1"># Example use:</span>
<a id="__codelineno-52-32" name="__codelineno-52-32"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-52-33" name="__codelineno-52-33"></a>    <span class="n">owner</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
<a id="__codelineno-52-34" name="__codelineno-52-34"></a>    <span class="n">balance</span> <span class="o">=</span> <span class="n">Float</span><span class="p">()</span>
<a id="__codelineno-52-35" name="__codelineno-52-35"></a>
<a id="__codelineno-52-36" name="__codelineno-52-36"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-52-37" name="__codelineno-52-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-52-38" name="__codelineno-52-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
</code></pre></div>
In this example, the class Typed defines a descriptor where type checking is performed when an attribute is assigned and an error is produced if an attempt is made to delete the attribute. The Integer, Float, and String subclasses specialize Type to match a specific type. The use of these classes in another class (such as Account) makes those attributes automatically call the appropriate <strong>get</strong>(), <strong>set</strong>(), or <strong>delete</strong>() methods on access. For example:</p>
<p>Click here to view code image</p>
<p>a = Account('Guido', 1000.0)
b = a.owner           # Calls Account.owner.<strong>get</strong>(a, Account)
a.owner = 'Eva'       # Calls Account.owner.<strong>set</strong>(a, 'Eva')
del f.owner           # Calls Account.owner.<strong>delete</strong>(a)</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a>Descriptors can only be instantiated at the class level. It is not legal to create descriptors on a per-instance basis by creating descriptor objects inside __init__() and other methods. The __set_name__() method of a descriptor is invoked after a class has been defined, but before any instances have been created, to inform a descriptor about the name that has been used within the class. For instance, the balance = Float() definition calls Float.__set_name__(Account, &#39;balance&#39;) to inform the descriptor of the class and name being used.
<a id="__codelineno-53-2" name="__codelineno-53-2"></a>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a>Descriptors with a __set__() method always take precedence over items in the instance dictionary. For example, if a descriptor happens to have the same name as a key in the instance dictionary, the descriptor takes priority. In the above Account example, you’ll see the descriptor applying type checking even though the instance dictionary has a matching entry:
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a>&gt;&gt;&gt; a = Account(&#39;Guido&#39;, 1000.0)
<a id="__codelineno-54-2" name="__codelineno-54-2"></a>&gt;&gt;&gt; a.__dict__
<a id="__codelineno-54-3" name="__codelineno-54-3"></a>{&#39;owner&#39;: &#39;Guido&#39;, &#39;balance&#39;: 1000.0 }
<a id="__codelineno-54-4" name="__codelineno-54-4"></a>&gt;&gt;&gt; a.balance = &#39;a lot&#39;
<a id="__codelineno-54-5" name="__codelineno-54-5"></a>Traceback (most recent call last):
<a id="__codelineno-54-6" name="__codelineno-54-6"></a>  File &#39;&lt;stdin&gt;&#39;, line 1, in &lt;module&gt;
<a id="__codelineno-54-7" name="__codelineno-54-7"></a>  File &#39;descrip.py&#39;, line 63, in __set__
<a id="__codelineno-54-8" name="__codelineno-54-8"></a>    raise TypeError(f&#39;Expected {self.expected_type}&#39;)
<a id="__codelineno-54-9" name="__codelineno-54-9"></a>TypeError: Expected &lt;class &#39;float&#39;&gt;
<a id="__codelineno-54-10" name="__codelineno-54-10"></a>&gt;&gt;&gt;
<a id="__codelineno-54-11" name="__codelineno-54-11"></a>The __get__(instance, cls) method of a descriptor takes arguments for both the instance and the class. It’s possible that __get__() is invoked at the class level, in which case the instance argument is None. In most cases, the __get__() returns the descriptor back if no instance is provided. For example:
<a id="__codelineno-54-12" name="__codelineno-54-12"></a>
<a id="__codelineno-54-13" name="__codelineno-54-13"></a>Click here to view code image
<a id="__codelineno-54-14" name="__codelineno-54-14"></a>
<a id="__codelineno-54-15" name="__codelineno-54-15"></a>&gt;&gt;&gt; Account.balance
<a id="__codelineno-54-16" name="__codelineno-54-16"></a>&lt;__main__.Float object at 0x110606710&gt;
<a id="__codelineno-54-17" name="__codelineno-54-17"></a>&gt;&gt;&gt;
</code></pre></div></p>
<h2 id="method-descriptor">method descriptor</h2>
<p>A descriptor that only implements <strong>get</strong>() is known as a method descriptor. It has a weaker binding than a descriptor with both get/set capabilities. Specifically, the <strong>get</strong>() method of a method descriptor only gets invoked if there is no matching entry in the instance dictionary. The reason it’s called a method descriptor is that this kind of descriptor is mainly used to implement Python’s various types of methods—including instance methods, class methods, and static methods.</p>
<p>For example, here’s a skeleton implementation that shows how @classmethod and @staticmethod could be implemented from scratch (the real implementation is more efficient):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="kn">import</span> <span class="nn">types</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="k">class</span> <span class="nc">classmethod</span><span class="p">:</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__func__</span> <span class="o">=</span> <span class="n">func</span>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a>    <span class="c1"># Return a bound method with cls as first argument</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a>        <span class="k">return</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__func__</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>
<a id="__codelineno-55-9" name="__codelineno-55-9"></a>
<a id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="k">class</span> <span class="nc">staticmethod</span><span class="p">:</span>
<a id="__codelineno-55-11" name="__codelineno-55-11"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<a id="__codelineno-55-12" name="__codelineno-55-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__func__</span> <span class="o">=</span> <span class="n">func</span>
<a id="__codelineno-55-13" name="__codelineno-55-13"></a>
<a id="__codelineno-55-14" name="__codelineno-55-14"></a>    <span class="c1"># Return the bare function</span>
<a id="__codelineno-55-15" name="__codelineno-55-15"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-55-16" name="__codelineno-55-16"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__func__</span>
</code></pre></div>
<h3 id="lazy-evaluation">lazy evaluation</h3>
<p>Since method descriptors only act if there is no matching entry in the instance dictionary, they can also be used to implement various forms of lazy evaluation of attributes. For example:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="k">class</span> <span class="nc">Lazy</span><span class="p">:</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a>    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a>        <span class="k">if</span> <span class="n">instance</span><span class="p">:</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a>            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a>            <span class="n">instance</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a>            <span class="k">return</span> <span class="n">value</span>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-56-14" name="__codelineno-56-14"></a>            <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-56-15" name="__codelineno-56-15"></a>
<a id="__codelineno-56-16" name="__codelineno-56-16"></a><span class="k">class</span> <span class="nc">Rectangle</span><span class="p">:</span>
<a id="__codelineno-56-17" name="__codelineno-56-17"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<a id="__codelineno-56-18" name="__codelineno-56-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
<a id="__codelineno-56-19" name="__codelineno-56-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
<a id="__codelineno-56-20" name="__codelineno-56-20"></a>
<a id="__codelineno-56-21" name="__codelineno-56-21"></a>    <span class="n">area</span> <span class="o">=</span> <span class="n">Lazy</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
<a id="__codelineno-56-22" name="__codelineno-56-22"></a>    <span class="n">perimeter</span> <span class="o">=</span> <span class="n">Lazy</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a>&gt;&gt;&gt; r = Rectangle(3, 4)
<a id="__codelineno-57-2" name="__codelineno-57-2"></a>&gt;&gt;&gt; r.__dict__
<a id="__codelineno-57-3" name="__codelineno-57-3"></a>{&#39;width&#39;: 3, &#39;height&#39;: 4 }
<a id="__codelineno-57-4" name="__codelineno-57-4"></a>&gt;&gt;&gt; r.area
<a id="__codelineno-57-5" name="__codelineno-57-5"></a>12
<a id="__codelineno-57-6" name="__codelineno-57-6"></a>&gt;&gt;&gt; r.perimeter
<a id="__codelineno-57-7" name="__codelineno-57-7"></a>14
<a id="__codelineno-57-8" name="__codelineno-57-8"></a>&gt;&gt;&gt; r.__dict__
<a id="__codelineno-57-9" name="__codelineno-57-9"></a>{&#39;width&#39;: 3, &#39;height&#39;: 4, &#39;area&#39;: 12, &#39;perimeter&#39;: 14 }
<a id="__codelineno-57-10" name="__codelineno-57-10"></a>&gt;&gt;&gt;
<a id="__codelineno-57-11" name="__codelineno-57-11"></a> ```
<a id="__codelineno-57-12" name="__codelineno-57-12"></a>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a>## class definitons
<a id="__codelineno-57-14" name="__codelineno-57-14"></a>
<a id="__codelineno-57-15" name="__codelineno-57-15"></a>The definition of a class is a dynamic process. When you define a class using the class statement, a new dictionary is created that serves as the local class namespace. The body of the class then executes as a script within this namespace. Eventually, the namespace becomes the __dict__ attribute of the resulting class object.
<a id="__codelineno-57-16" name="__codelineno-57-16"></a>
<a id="__codelineno-57-17" name="__codelineno-57-17"></a>Any legal Python statement is allowed in the body of a class. Normally, you just define functions and variables, but control flow, imports, nested classes, and everything else is allowed. For example, here is a class that conditionally defines methods:
<a id="__codelineno-57-18" name="__codelineno-57-18"></a>
<a id="__codelineno-57-19" name="__codelineno-57-19"></a>
<a id="__codelineno-57-20" name="__codelineno-57-20"></a>
<a id="__codelineno-57-21" name="__codelineno-57-21"></a>```python
<a id="__codelineno-57-22" name="__codelineno-57-22"></a>class Account:
<a id="__codelineno-57-23" name="__codelineno-57-23"></a>    def __init__(self, owner, balance):
<a id="__codelineno-57-24" name="__codelineno-57-24"></a>        self.owner = owner
<a id="__codelineno-57-25" name="__codelineno-57-25"></a>        self.balance = balance
<a id="__codelineno-57-26" name="__codelineno-57-26"></a>
<a id="__codelineno-57-27" name="__codelineno-57-27"></a>    if debug:
<a id="__codelineno-57-28" name="__codelineno-57-28"></a>        import logging
<a id="__codelineno-57-29" name="__codelineno-57-29"></a>        log = logging.getLogger(f&#39;{__module__}.{__qualname__}&#39;)
<a id="__codelineno-57-30" name="__codelineno-57-30"></a>        def deposit(self, amount):
<a id="__codelineno-57-31" name="__codelineno-57-31"></a>            Account.log.debug(&#39;Depositing %f&#39;, amount)
<a id="__codelineno-57-32" name="__codelineno-57-32"></a>            self.balance += amount
<a id="__codelineno-57-33" name="__codelineno-57-33"></a>
<a id="__codelineno-57-34" name="__codelineno-57-34"></a>        def withdraw(self, amount):
<a id="__codelineno-57-35" name="__codelineno-57-35"></a>            Account.log.debug(&#39;Withdrawing %f&#39;, amount)
<a id="__codelineno-57-36" name="__codelineno-57-36"></a>            self.balance -= amount
<a id="__codelineno-57-37" name="__codelineno-57-37"></a>    else:
<a id="__codelineno-57-38" name="__codelineno-57-38"></a>        def deposit(self, amount):
<a id="__codelineno-57-39" name="__codelineno-57-39"></a>            self.balance += amount
<a id="__codelineno-57-40" name="__codelineno-57-40"></a>
<a id="__codelineno-57-41" name="__codelineno-57-41"></a>        def withdraw(self, amount):
<a id="__codelineno-57-42" name="__codelineno-57-42"></a>            self.balance -= amount
</code></pre></div></p>
<p>n this example, a global variable debug is being used to conditionally define methods. The <strong>qualname</strong> and <strong>module</strong> variables are predefined strings that hold information about the class name and enclosing module. These can be used by statements in the class body. In this example, they’re being used to configure the logging system. There are probably cleaner ways of organizing the above code, but the key point is that you can put anything you want in a class.</p>
<p>One critical point about class definition is that the namespace used to hold the contents of the class body is not a scope of variables. Any name that gets used within a method (such as Account.log in the above example) needs to be fully qualified.</p>
<p>If a function like locals() is used in a class body (but not inside a method), it returns the dictionary being used for the class namespace.</p>
<h2 id="dynamic-class-creation">dynamic class creation</h2>
<p>Normally, classes are created using the class statement, but this is not a requirement. As noted in the previous section, classes are defined by executing the body of a class to populate a namespace. If you’re able to populate a dictionary with your own definitions, you can make a class without ever using the class statement. To do that, use types.new_class():</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="kn">import</span> <span class="nn">types</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="c1"># Some methods (not in a class)</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
<a id="__codelineno-58-10" name="__codelineno-58-10"></a>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="n">methods</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-58-15" name="__codelineno-58-15"></a>   <span class="s1">&#39;__init__&#39;</span><span class="p">:</span> <span class="fm">__init__</span><span class="p">,</span>
<a id="__codelineno-58-16" name="__codelineno-58-16"></a>   <span class="s1">&#39;deposit&#39;</span><span class="p">:</span> <span class="n">deposit</span><span class="p">,</span>
<a id="__codelineno-58-17" name="__codelineno-58-17"></a>   <span class="s1">&#39;withdraw&#39;</span><span class="p">:</span> <span class="n">withdraw</span><span class="p">,</span>
<a id="__codelineno-58-18" name="__codelineno-58-18"></a><span class="p">}</span>
<a id="__codelineno-58-19" name="__codelineno-58-19"></a>
<a id="__codelineno-58-20" name="__codelineno-58-20"></a><span class="n">Account</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">new_class</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="p">(),</span>
<a id="__codelineno-58-21" name="__codelineno-58-21"></a>               <span class="n">exec_body</span><span class="o">=</span><span class="k">lambda</span> <span class="n">ns</span><span class="p">:</span> <span class="n">ns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">methods</span><span class="p">))</span>
<a id="__codelineno-58-22" name="__codelineno-58-22"></a>
<a id="__codelineno-58-23" name="__codelineno-58-23"></a><span class="c1"># You now have a class</span>
<a id="__codelineno-58-24" name="__codelineno-58-24"></a><span class="n">a</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
<a id="__codelineno-58-25" name="__codelineno-58-25"></a><span class="n">a</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-58-26" name="__codelineno-58-26"></a><span class="n">a</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</code></pre></div>
<p>Dynamic class creation may be useful if you want to create classes from data structures. For example, in the section on descriptors, the following classes were defined:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="k">class</span> <span class="nc">Integer</span><span class="p">(</span><span class="n">Typed</span><span class="p">):</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">int</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="k">class</span> <span class="nc">Float</span><span class="p">(</span><span class="n">Typed</span><span class="p">):</span>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">float</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="n">Typed</span><span class="p">):</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a>    <span class="n">expected_type</span> <span class="o">=</span> <span class="nb">str</span>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a><span class="n">This</span> <span class="n">code</span> <span class="ow">is</span> <span class="n">highly</span> <span class="n">repetitive</span><span class="o">.</span> <span class="n">Perhaps</span> <span class="n">a</span> <span class="n">data</span><span class="o">-</span><span class="n">driven</span> <span class="n">approach</span> <span class="n">would</span> <span class="n">be</span> <span class="n">better</span><span class="p">:</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a><span class="n">Click</span> <span class="n">here</span> <span class="n">to</span> <span class="n">view</span> <span class="n">code</span> <span class="n">image</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a>
<a id="__codelineno-59-13" name="__codelineno-59-13"></a><span class="n">typed_classes</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a>   <span class="p">(</span><span class="s1">&#39;Integer&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-59-15" name="__codelineno-59-15"></a>   <span class="p">(</span><span class="s1">&#39;Float&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<a id="__codelineno-59-16" name="__codelineno-59-16"></a>   <span class="p">(</span><span class="s1">&#39;String&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
<a id="__codelineno-59-17" name="__codelineno-59-17"></a>   <span class="p">(</span><span class="s1">&#39;Bool&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>
<a id="__codelineno-59-18" name="__codelineno-59-18"></a>   <span class="p">(</span><span class="s1">&#39;Tuple&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">),</span>
<a id="__codelineno-59-19" name="__codelineno-59-19"></a><span class="p">]</span>
<a id="__codelineno-59-20" name="__codelineno-59-20"></a>
<a id="__codelineno-59-21" name="__codelineno-59-21"></a><span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-59-22" name="__codelineno-59-22"></a>   <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">new_class</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">Typed</span><span class="p">,),</span>
<a id="__codelineno-59-23" name="__codelineno-59-23"></a>          <span class="n">exec_body</span><span class="o">=</span><span class="k">lambda</span> <span class="n">ns</span><span class="p">:</span> <span class="n">ns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">expected_type</span><span class="o">=</span><span class="n">ty</span><span class="p">)))</span>
<a id="__codelineno-59-24" name="__codelineno-59-24"></a>   <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">ty</span> <span class="ow">in</span> <span class="n">typed_classes</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a>In this example, the global module namespace is being updated with dynamically created classes using types.new_class(). If you want to make more classes, put an appropriate entry in the typed_classes list.
<a id="__codelineno-60-2" name="__codelineno-60-2"></a>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a>Sometimes you will see type() being used to dynamically create a class instead. For example:
<a id="__codelineno-60-4" name="__codelineno-60-4"></a>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a>Account = type(&#39;Account&#39;, (), methods)
<a id="__codelineno-60-6" name="__codelineno-60-6"></a>This works, but it doesn’t take into account some of the more advanced class machinery such as metaclasses (to be discussed shortly). In modern code, try to use types.new_class() instead.
</code></pre></div>
<h2 id="metaclasses">metaclasses</h2>
<p>When you define a class in Python, the class definition itself becomes an object. Here’s an example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a><span class="nb">isinstance</span><span class="p">(</span><span class="n">Account</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>    
</code></pre></div>
<p>If you think about this long enough, you will realize that if Account is an object, then something had to create it. This creation of the class object is controlled by a special kind of class called a metaclass. Simply put, a metaclass is a class that creates instances of classes.</p>
<p>In the preceding example, the metaclass that created Account is a built-in class called type. In fact, if you check the type of Account, you will see that it is an instance of type:</p>
<p>Click here to view code image</p>
<blockquote>
<blockquote>
<blockquote>
<p>Account.<strong>class</strong>
<type 'type'></p>
</blockquote>
</blockquote>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a>It’s a bit brain-bending, but it’s similar to integers. For example, if you write x = 42 and then look at x.__class__, you’ll get int, which is the class that creates integers. Similarly, type makes instances of types or classes.
<a id="__codelineno-62-2" name="__codelineno-62-2"></a>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a>When a new class is defined with the class statement, a number of things happen. First, a new namespace for the class is created. Next, the body of the class is executed in this namespace. Finally, the class name, base classes, and populated namespace are used to create the class instance. The following code illustrates the low-level steps that take place:
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="n">namespace</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__prepare__</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="p">())</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="c1"># Step 2: Execute the class body</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="n">exec</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="s1">def __init__(self, owner, balance):</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><span class="s1">    self.owner = owner</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="s1">    self.balance = balance</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a><span class="s1">def deposit(self, amount):</span>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="s1">    self.balance += amount</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a><span class="s1">def withdraw(self, amount):</span>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a><span class="s1">    self.balance -= amount</span>
<a id="__codelineno-63-14" name="__codelineno-63-14"></a><span class="s1">&#39;&#39;&#39;</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-63-15" name="__codelineno-63-15"></a>
<a id="__codelineno-63-16" name="__codelineno-63-16"></a><span class="c1"># Step 3: Create the final class object</span>
<a id="__codelineno-63-17" name="__codelineno-63-17"></a><span class="n">Account</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">namespace</span><span class="p">)</span>
</code></pre></div>
<p>n the definition process, there is interaction with the type class to create the class namespace and to create the final class object. The choice of using type can be customized—a class can choose to be processed by a different type class by specifying a different metaclass. This is done by using the metaclass keyword argument in inheritance:</p>
<p>class Account(metaclass=type):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a>If no metaclass is given, the class statement examines the type of the first entry in the tuple of base classes (if any) and uses that as the metaclass. Therefore, if you write class Account(object), the resulting Account class will have the same type as object (which is type). Note that classes that don’t specify any parent at all always inherit from object, so this still applies.
<a id="__codelineno-64-2" name="__codelineno-64-2"></a>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a>To create a new metaclass, define a class that inherits from type. Within this class, you can redefine one or more methods that are used during the class creation process. Typically, this includes the __prepare__() method used to create the class namespace, the __new__() method used to create the class instance, the __init__() method called after a class has already been created, and the __call__() method used to create new instances. The following example implements a metaclass that merely prints the input arguments to each method so you can experiment:
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="k">class</span> <span class="nc">mytype</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a>    <span class="c1"># Creates the class namespace</span>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-65-5" name="__codelineno-65-5"></a>    <span class="k">def</span> <span class="fm">__prepare__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preparing:&#39;</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
<a id="__codelineno-65-7" name="__codelineno-65-7"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__prepare__</span><span class="p">(</span><span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a>
<a id="__codelineno-65-9" name="__codelineno-65-9"></a>    <span class="c1"># Creates the class instance after body has executed</span>
<a id="__codelineno-65-10" name="__codelineno-65-10"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-65-11" name="__codelineno-65-11"></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
<a id="__codelineno-65-12" name="__codelineno-65-12"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating:&#39;</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-65-13" name="__codelineno-65-13"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-65-14" name="__codelineno-65-14"></a>
<a id="__codelineno-65-15" name="__codelineno-65-15"></a>    <span class="c1"># Initializes the class instance</span>
<a id="__codelineno-65-16" name="__codelineno-65-16"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
<a id="__codelineno-65-17" name="__codelineno-65-17"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initializing:&#39;</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-65-18" name="__codelineno-65-18"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-65-19" name="__codelineno-65-19"></a>
<a id="__codelineno-65-20" name="__codelineno-65-20"></a>    <span class="c1"># Creates new instances of the class</span>
<a id="__codelineno-65-21" name="__codelineno-65-21"></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-65-22" name="__codelineno-65-22"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating instance:&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-65-23" name="__codelineno-65-23"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-65-24" name="__codelineno-65-24"></a>
<a id="__codelineno-65-25" name="__codelineno-65-25"></a><span class="c1"># Example</span>
<a id="__codelineno-65-26" name="__codelineno-65-26"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">mytype</span><span class="p">):</span>
<a id="__codelineno-65-27" name="__codelineno-65-27"></a>    <span class="k">pass</span>
<a id="__codelineno-65-28" name="__codelineno-65-28"></a>
<a id="__codelineno-65-29" name="__codelineno-65-29"></a><span class="c1"># Definition of the Base produces the following output</span>
<a id="__codelineno-65-30" name="__codelineno-65-30"></a><span class="c1"># Preparing: Base ()</span>
<a id="__codelineno-65-31" name="__codelineno-65-31"></a><span class="c1"># Creating: Base () {&#39;__module__&#39;: &#39;__main__&#39;, &#39;__qualname__&#39;: &#39;Base&#39;}</span>
<a id="__codelineno-65-32" name="__codelineno-65-32"></a><span class="c1"># Initializing: Base () {&#39;__module__&#39;: &#39;__main__&#39;, &#39;__qualname__&#39;: &#39;Base&#39;}</span>
<a id="__codelineno-65-33" name="__codelineno-65-33"></a>
<a id="__codelineno-65-34" name="__codelineno-65-34"></a><span class="n">b</span> <span class="o">=</span> <span class="n">Base</span><span class="p">()</span>
<a id="__codelineno-65-35" name="__codelineno-65-35"></a><span class="c1"># Creating instance: () {}</span>
</code></pre></div>
<p>One tricky facet of working with metaclasses is the naming of variables and keeping track of the various entities involved. In the above code, the meta name refers to the metaclass itself. The cls name refers to a class instance created by the metaclass. Although not used here, the self name refers to a normal instance created by a class.</p>
<p>Metaclasses propagate via inheritance. So, if you’ve defined a base class to use a different metaclass, all child classes will also use that metaclass. Try this example to see your custom metaclass at work</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">balance</span><span class="p">):</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-66-7" name="__codelineno-66-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>
<a id="__codelineno-66-8" name="__codelineno-66-8"></a>
<a id="__codelineno-66-9" name="__codelineno-66-9"></a>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<a id="__codelineno-66-10" name="__codelineno-66-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
<a id="__codelineno-66-11" name="__codelineno-66-11"></a>
<a id="__codelineno-66-12" name="__codelineno-66-12"></a><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Account</span><span class="p">))</span>   <span class="c1"># -&gt; &lt;class &#39;mytype&#39;&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a>The primary use of metaclasses is in situations where you want to exert extreme low-level control over the class definition environment and creation process. Before proceeding, however, remember that Python already provides a lot of functionality for monitoring and altering class definitions (such as the __init_subclass__() method, class decorators, descriptors, mixins, and so on). Most of the time, you probably don’t need a metaclass. That said, the next few examples show situations where a metaclass provides the only sensible solution.
<a id="__codelineno-67-2" name="__codelineno-67-2"></a>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a>One use of a metaclass is in rewriting the contents of the class namespace prior to the creation of the class object. Certain features of classes are established at definition time and can’t be modified later. One such feature is __slots__. As noted earlier, __slots__ is a performance optimization related to the memory layout of instances. Here’s a metaclass that automatically sets the __slots__ attribute based on the calling signature of the __init__() method.
</code></pre></div>
<p>automatic <strong>slot</strong> implemented class</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="kn">import</span> <span class="nn">inspect</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="k">class</span> <span class="nc">SlotMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">methods</span><span class="p">):</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a>        <span class="k">if</span> <span class="s1">&#39;__init__&#39;</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
<a id="__codelineno-68-7" name="__codelineno-68-7"></a>            <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">methods</span><span class="p">[</span><span class="s1">&#39;__init__&#39;</span><span class="p">])</span>
<a id="__codelineno-68-8" name="__codelineno-68-8"></a>            <span class="vm">__slots__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-68-9" name="__codelineno-68-9"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-68-10" name="__codelineno-68-10"></a>            <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
<a id="__codelineno-68-11" name="__codelineno-68-11"></a>        <span class="n">methods</span><span class="p">[</span><span class="s1">&#39;__slots__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="vm">__slots__</span>
<a id="__codelineno-68-12" name="__codelineno-68-12"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span>
<a id="__codelineno-68-13" name="__codelineno-68-13"></a>
<a id="__codelineno-68-14" name="__codelineno-68-14"></a><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">SlotMeta</span><span class="p">):</span>
<a id="__codelineno-68-15" name="__codelineno-68-15"></a>    <span class="k">pass</span>
<a id="__codelineno-68-16" name="__codelineno-68-16"></a>
<a id="__codelineno-68-17" name="__codelineno-68-17"></a><span class="c1"># Example</span>
<a id="__codelineno-68-18" name="__codelineno-68-18"></a><span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
<a id="__codelineno-68-19" name="__codelineno-68-19"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-68-20" name="__codelineno-68-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<a id="__codelineno-68-21" name="__codelineno-68-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
</code></pre></div>
<p>In this example, the Point class that’s created is automatically created with <strong>slots</strong> of ('x', 'y'). The resulting instances of Point now get memory savings without knowing that slots are being used. It doesn’t have to be specified directly. This kind of trick is not possible with class decorators or with <strong>init_subclass</strong>() because those features only operate on a class after it’s been created. By then, it’s too late to apply the <strong>slots</strong> optimization.</p>
<p>Another use of metaclasses is for altering the class definition environment. For example, duplicate definitions of a name during class definition normally result in a silent error—the second definition overwrites the first. Suppose you wanted to catch that. Here’s a metaclass that does that by defining a different kind of dictionary for the class namespace:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a>class NoDupeDict(dict):
<a id="__codelineno-69-2" name="__codelineno-69-2"></a>    def __setitem__(self, key, value):
<a id="__codelineno-69-3" name="__codelineno-69-3"></a>        if key in self:
<a id="__codelineno-69-4" name="__codelineno-69-4"></a>            raise AttributeError(f&#39;{key} already defined&#39;)
<a id="__codelineno-69-5" name="__codelineno-69-5"></a>        super().__setitem__(key, value)
<a id="__codelineno-69-6" name="__codelineno-69-6"></a>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a>class NoDupeMeta(type):
<a id="__codelineno-69-8" name="__codelineno-69-8"></a>    @classmethod
<a id="__codelineno-69-9" name="__codelineno-69-9"></a>    def __prepare__(meta, clsname, bases):
<a id="__codelineno-69-10" name="__codelineno-69-10"></a>        return NoDupeDict()
<a id="__codelineno-69-11" name="__codelineno-69-11"></a>
<a id="__codelineno-69-12" name="__codelineno-69-12"></a>class Base(metaclass=NoDupeMeta):
<a id="__codelineno-69-13" name="__codelineno-69-13"></a>    pass
<a id="__codelineno-69-14" name="__codelineno-69-14"></a>
<a id="__codelineno-69-15" name="__codelineno-69-15"></a># Example
<a id="__codelineno-69-16" name="__codelineno-69-16"></a>class SomeClass(Base):
<a id="__codelineno-69-17" name="__codelineno-69-17"></a>    def yow(self):
<a id="__codelineno-69-18" name="__codelineno-69-18"></a>        print(&#39;Yow!&#39;)
<a id="__codelineno-69-19" name="__codelineno-69-19"></a>
<a id="__codelineno-69-20" name="__codelineno-69-20"></a>    def yow(self, x):             # Fails. Already defined
<a id="__codelineno-69-21" name="__codelineno-69-21"></a>        print(&#39;Different Yow!&#39;)
</code></pre></div>
<p>This is only a small sample of what’s possible. For framework builders, metaclasses offer an opportunity to tightly control what happens during class definition—allowing classes to serve as a kind of domain-specific language.</p>
<p>Historically, metaclasses have been used to accomplish a variety of tasks that are now possible through other means. The <strong>init_subclass</strong>() method, in particular, can be used to address a wide variety of use cases where metaclasses were once applied. This includes registration of classes with a central registry, automatic decoration of methods, and code generation.</p>
<h2 id="built-in-objects-for-instances-and-classes">Built-in Objects for Instances and Classes</h2>
<p>Class Attrs
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a>cls.__name__
<a id="__codelineno-70-2" name="__codelineno-70-2"></a>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a>Class name
<a id="__codelineno-70-4" name="__codelineno-70-4"></a>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a>cls.__module__
<a id="__codelineno-70-6" name="__codelineno-70-6"></a>
<a id="__codelineno-70-7" name="__codelineno-70-7"></a>Module name in which the class is defined
<a id="__codelineno-70-8" name="__codelineno-70-8"></a>
<a id="__codelineno-70-9" name="__codelineno-70-9"></a>cls.__qualname__
<a id="__codelineno-70-10" name="__codelineno-70-10"></a>
<a id="__codelineno-70-11" name="__codelineno-70-11"></a>Fully qualified class name
<a id="__codelineno-70-12" name="__codelineno-70-12"></a>
<a id="__codelineno-70-13" name="__codelineno-70-13"></a>cls.__bases__
<a id="__codelineno-70-14" name="__codelineno-70-14"></a>
<a id="__codelineno-70-15" name="__codelineno-70-15"></a>Tuple of base classes
<a id="__codelineno-70-16" name="__codelineno-70-16"></a>
<a id="__codelineno-70-17" name="__codelineno-70-17"></a>cls.__mro__
<a id="__codelineno-70-18" name="__codelineno-70-18"></a>
<a id="__codelineno-70-19" name="__codelineno-70-19"></a>Method Resolution Order tuple
<a id="__codelineno-70-20" name="__codelineno-70-20"></a>
<a id="__codelineno-70-21" name="__codelineno-70-21"></a>cls.__dict__
<a id="__codelineno-70-22" name="__codelineno-70-22"></a>
<a id="__codelineno-70-23" name="__codelineno-70-23"></a>Dictionary holding class methods and variables
<a id="__codelineno-70-24" name="__codelineno-70-24"></a>
<a id="__codelineno-70-25" name="__codelineno-70-25"></a>cls.__doc__
<a id="__codelineno-70-26" name="__codelineno-70-26"></a>
<a id="__codelineno-70-27" name="__codelineno-70-27"></a>Documentation string
<a id="__codelineno-70-28" name="__codelineno-70-28"></a>
<a id="__codelineno-70-29" name="__codelineno-70-29"></a>cls.__annotations__
<a id="__codelineno-70-30" name="__codelineno-70-30"></a>
<a id="__codelineno-70-31" name="__codelineno-70-31"></a>Dictionary of class type hints
<a id="__codelineno-70-32" name="__codelineno-70-32"></a>
<a id="__codelineno-70-33" name="__codelineno-70-33"></a>cls.__abstractmethods__
<a id="__codelineno-70-34" name="__codelineno-70-34"></a>
<a id="__codelineno-70-35" name="__codelineno-70-35"></a>Set of abstract method names (may be undefined if there aren’t any).
</code></pre></div>
Instance attrs</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a>i.__class__
<a id="__codelineno-71-2" name="__codelineno-71-2"></a>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a>Class to which the instance belongs
<a id="__codelineno-71-4" name="__codelineno-71-4"></a>
<a id="__codelineno-71-5" name="__codelineno-71-5"></a>i.__dict__
<a id="__codelineno-71-6" name="__codelineno-71-6"></a>
<a id="__codelineno-71-7" name="__codelineno-71-7"></a>Dictionary holding instance data (if defined)
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../modules/" class="md-footer__link md-footer__link--prev" aria-label="Previous: modules" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              modules
            </div>
          </div>
        </a>
      
      
        
        <a href="../io/" class="md-footer__link md-footer__link--next" aria-label="Next: IO" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              IO
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.8aa65030.min.js"></script>
      
    
  </body>
</html>