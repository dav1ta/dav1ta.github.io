
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../structure/structure/">
      
      
        <link rel="next" href="../threading/threading/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>asyncio - Elibrary</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-introduction-to-asynchronous-programming" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Elibrary" class="md-header__button md-logo" aria-label="Elibrary" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Elibrary
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              asyncio
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Elibrary" class="md-nav__button md-logo" aria-label="Elibrary" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Elibrary
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Classes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Classes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../classes/classes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../classes/data_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../classes/descriptors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descriptors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../classes/iterators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iterators
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../context_managers/context_managers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Context Managers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Types
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Data Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_types/data_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_types/dic_set/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dict & Set
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_types/list_tuple/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    List & Tuple
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_types/object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Object
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decorators/decorators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decorators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/builtins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Builtins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Structure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Structure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../structure/code_design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../structure/dessign_patterns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Design Patterns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../structure/practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../structure/solid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SOLID
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../structure/structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Structure
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" checked>
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Async
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Async
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    asyncio
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    asyncio
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction-to-asynchronous-programming" class="md-nav__link">
    <span class="md-ellipsis">
      1. Introduction to Asynchronous Programming
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-traditional-multi-threading-vs-asynchronous-programming" class="md-nav__link">
    <span class="md-ellipsis">
      2. Traditional Multi-threading vs Asynchronous Programming
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-pythons-asyncio-basics" class="md-nav__link">
    <span class="md-ellipsis">
      3. Python's asyncio Basics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Python's asyncio Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-async-await" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. async &amp; await
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-event-loop" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. Event Loop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-tasks-and-coroutines" class="md-nav__link">
    <span class="md-ellipsis">
      3.3. Tasks and Coroutines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-asynchronous-io-with-python" class="md-nav__link">
    <span class="md-ellipsis">
      4. Asynchronous I/O with Python
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-advanced-techniques-in-asynchronous-programming" class="md-nav__link">
    <span class="md-ellipsis">
      5. Advanced Techniques in Asynchronous Programming
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Advanced Techniques in Asynchronous Programming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-managing-multiple-tasks-with-gather-wait" class="md-nav__link">
    <span class="md-ellipsis">
      5.1. Managing Multiple Tasks with gather &amp; wait
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-handling-timeouts-and-delays" class="md-nav__link">
    <span class="md-ellipsis">
      5.2. Handling Timeouts and Delays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-error-handling-in-async-context" class="md-nav__link">
    <span class="md-ellipsis">
      5.3. Error Handling in Async Context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-integration-with-other-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      6. Integration with Other Libraries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Integration with Other Libraries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-aiohttp-for-asynchronous-http-requests" class="md-nav__link">
    <span class="md-ellipsis">
      6.1. aiohttp for Asynchronous HTTP Requests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-aiomysql-aiopg-for-asynchronous-database-operations" class="md-nav__link">
    <span class="md-ellipsis">
      6.2. aiomysql &amp; aiopg for Asynchronous Database Operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-potential-pitfalls-and-common-mistakes" class="md-nav__link">
    <span class="md-ellipsis">
      7. Potential Pitfalls and Common Mistakes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Potential Pitfalls and Common Mistakes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-mixing-sync-and-async-code" class="md-nav__link">
    <span class="md-ellipsis">
      7.1. Mixing Sync and Async Code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-forgetting-await" class="md-nav__link">
    <span class="md-ellipsis">
      7.2. Forgetting await
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-not-handling-exceptions-in-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      7.3. Not Handling Exceptions in Tasks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-best-practices-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      8. Best Practices &amp; Recommendations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Best Practices & Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-use-async-and-await-consistently" class="md-nav__link">
    <span class="md-ellipsis">
      8.1. Use async and await Consistently
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-favor-high-level-apis" class="md-nav__link">
    <span class="md-ellipsis">
      8.2. Favor High-Level APIs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-use-asynchronous-context-managers" class="md-nav__link">
    <span class="md-ellipsis">
      8.3. Use Asynchronous Context Managers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-be-wary-of-thread-safety" class="md-nav__link">
    <span class="md-ellipsis">
      8.4. Be Wary of Thread-Safety
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-conclusion-and-future-of-python-async" class="md-nav__link">
    <span class="md-ellipsis">
      9. Conclusion and Future of Python Async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-advanced-queue-operations-with-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      10. Advanced Queue Operations with asyncio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Advanced Queue Operations with asyncio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-basic-queue-operations" class="md-nav__link">
    <span class="md-ellipsis">
      10.1. Basic Queue Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-implementing-producer-consumer-with-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      10.2. Implementing Producer-Consumer with asyncio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103-limiting-queue-size" class="md-nav__link">
    <span class="md-ellipsis">
      10.3. Limiting Queue Size
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-more-advanced-techniques-in-asynchronous-programming" class="md-nav__link">
    <span class="md-ellipsis">
      11. More Advanced Techniques in Asynchronous Programming
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. More Advanced Techniques in Asynchronous Programming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-priority-queues" class="md-nav__link">
    <span class="md-ellipsis">
      11.1. Priority Queues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-semaphores-and-locks" class="md-nav__link">
    <span class="md-ellipsis">
      11.2. Semaphores and Locks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113-async-streams" class="md-nav__link">
    <span class="md-ellipsis">
      11.3. Async Streams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-exception-propagation" class="md-nav__link">
    <span class="md-ellipsis">
      11.4. Exception Propagation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-using-tasks-effectively" class="md-nav__link">
    <span class="md-ellipsis">
      11.5. Using Tasks Effectively
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-combining-async-io-with-multiprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      12. Combining Async IO with Multiprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. Combining Async IO with Multiprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-basic-async-with-multiprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      12.1. Basic Async with Multiprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-asynchronous-process-communication" class="md-nav__link">
    <span class="md-ellipsis">
      12.2. Asynchronous Process Communication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-challenges-and-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      12.3. Challenges and Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-advanced-patterns-and-designs-in-async-applications" class="md-nav__link">
    <span class="md-ellipsis">
      13. Advanced Patterns and Designs in Async Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13. Advanced Patterns and Designs in Async Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-event-driven-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      13.1. Event-driven Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-service-actor-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      13.2. Service Actor Pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-reactive-extensions-rxpy-with-async" class="md-nav__link">
    <span class="md-ellipsis">
      13.3. Reactive Extensions (RxPY with Async)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-debugging-and-profiling-asynchronous-python-applications" class="md-nav__link">
    <span class="md-ellipsis">
      14. Debugging and Profiling Asynchronous Python Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14. Debugging and Profiling Asynchronous Python Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-debug-mode-in-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      14.1. Debug Mode in asyncio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-logging-unclosed-resources" class="md-nav__link">
    <span class="md-ellipsis">
      14.2. Logging Unclosed Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-profiling-with-aio-profiler" class="md-nav__link">
    <span class="md-ellipsis">
      14.3. Profiling with aio-profiler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-debugging-with-ides" class="md-nav__link">
    <span class="md-ellipsis">
      14.4. Debugging with IDEs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#145-detecting-deadlocks" class="md-nav__link">
    <span class="md-ellipsis">
      14.5. Detecting Deadlocks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#146-monitoring-asynchronous-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      14.6. Monitoring Asynchronous Tasks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-scaling-and-deploying-asynchronous-applications" class="md-nav__link">
    <span class="md-ellipsis">
      15. Scaling and Deploying Asynchronous Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15. Scaling and Deploying Asynchronous Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151-event-loop-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      15.1. Event Loop Implementations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#152-load-balancing" class="md-nav__link">
    <span class="md-ellipsis">
      15.2. Load Balancing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#153-distributed-systems-and-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      15.3. Distributed Systems and Microservices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#154-database-connections" class="md-nav__link">
    <span class="md-ellipsis">
      15.4. Database Connections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#155-memory-and-resource-leaks" class="md-nav__link">
    <span class="md-ellipsis">
      15.5. Memory and Resource Leaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#156-error-monitoring-and-alerting" class="md-nav__link">
    <span class="md-ellipsis">
      15.6. Error Monitoring and Alerting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#16-conclusion-and-continuous-learning-in-asynchronous-programming" class="md-nav__link">
    <span class="md-ellipsis">
      16. Conclusion and Continuous Learning in Asynchronous Programming
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-async-without-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      EXTRA async without asyncio
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../threading/threading/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Threading
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../talks/talks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    From Talks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/pytest_fixtures.py" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Docker
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker-compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Compose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Postgres
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Postgres
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../postgresql/tricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perfomance tricks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Git
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Git
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../git/flows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workflows
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Angular
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Angular
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../angular/rxjs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rxjs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../angular/tips/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tips
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setups
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Setups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setups/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gitlab
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/deployments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/image-security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Image Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/lifecycle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lifecycle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/maintanence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maintenance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/namespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Namespaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/newtwork/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/pods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pods
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/replicasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReplicaSets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/roles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/sheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scheduler
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Programming
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Programming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/code_review/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Review
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/algorithms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/orm_sql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ORM
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ansible/ansible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Other
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Other
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/tmux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tmux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/nvim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Neovim
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cybersec
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Cybersec
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cybersecurity/softwaresecurity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sofware Security
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Rust
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Rust
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rust/vars/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rust/generators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rust/object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rust/memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memory
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction-to-asynchronous-programming" class="md-nav__link">
    <span class="md-ellipsis">
      1. Introduction to Asynchronous Programming
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-traditional-multi-threading-vs-asynchronous-programming" class="md-nav__link">
    <span class="md-ellipsis">
      2. Traditional Multi-threading vs Asynchronous Programming
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-pythons-asyncio-basics" class="md-nav__link">
    <span class="md-ellipsis">
      3. Python's asyncio Basics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Python's asyncio Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-async-await" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. async &amp; await
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-event-loop" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. Event Loop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-tasks-and-coroutines" class="md-nav__link">
    <span class="md-ellipsis">
      3.3. Tasks and Coroutines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-asynchronous-io-with-python" class="md-nav__link">
    <span class="md-ellipsis">
      4. Asynchronous I/O with Python
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-advanced-techniques-in-asynchronous-programming" class="md-nav__link">
    <span class="md-ellipsis">
      5. Advanced Techniques in Asynchronous Programming
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Advanced Techniques in Asynchronous Programming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-managing-multiple-tasks-with-gather-wait" class="md-nav__link">
    <span class="md-ellipsis">
      5.1. Managing Multiple Tasks with gather &amp; wait
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-handling-timeouts-and-delays" class="md-nav__link">
    <span class="md-ellipsis">
      5.2. Handling Timeouts and Delays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-error-handling-in-async-context" class="md-nav__link">
    <span class="md-ellipsis">
      5.3. Error Handling in Async Context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-integration-with-other-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      6. Integration with Other Libraries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Integration with Other Libraries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-aiohttp-for-asynchronous-http-requests" class="md-nav__link">
    <span class="md-ellipsis">
      6.1. aiohttp for Asynchronous HTTP Requests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-aiomysql-aiopg-for-asynchronous-database-operations" class="md-nav__link">
    <span class="md-ellipsis">
      6.2. aiomysql &amp; aiopg for Asynchronous Database Operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-potential-pitfalls-and-common-mistakes" class="md-nav__link">
    <span class="md-ellipsis">
      7. Potential Pitfalls and Common Mistakes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Potential Pitfalls and Common Mistakes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-mixing-sync-and-async-code" class="md-nav__link">
    <span class="md-ellipsis">
      7.1. Mixing Sync and Async Code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-forgetting-await" class="md-nav__link">
    <span class="md-ellipsis">
      7.2. Forgetting await
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-not-handling-exceptions-in-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      7.3. Not Handling Exceptions in Tasks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-best-practices-recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      8. Best Practices &amp; Recommendations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Best Practices & Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-use-async-and-await-consistently" class="md-nav__link">
    <span class="md-ellipsis">
      8.1. Use async and await Consistently
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-favor-high-level-apis" class="md-nav__link">
    <span class="md-ellipsis">
      8.2. Favor High-Level APIs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-use-asynchronous-context-managers" class="md-nav__link">
    <span class="md-ellipsis">
      8.3. Use Asynchronous Context Managers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-be-wary-of-thread-safety" class="md-nav__link">
    <span class="md-ellipsis">
      8.4. Be Wary of Thread-Safety
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-conclusion-and-future-of-python-async" class="md-nav__link">
    <span class="md-ellipsis">
      9. Conclusion and Future of Python Async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-advanced-queue-operations-with-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      10. Advanced Queue Operations with asyncio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Advanced Queue Operations with asyncio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-basic-queue-operations" class="md-nav__link">
    <span class="md-ellipsis">
      10.1. Basic Queue Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-implementing-producer-consumer-with-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      10.2. Implementing Producer-Consumer with asyncio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103-limiting-queue-size" class="md-nav__link">
    <span class="md-ellipsis">
      10.3. Limiting Queue Size
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-more-advanced-techniques-in-asynchronous-programming" class="md-nav__link">
    <span class="md-ellipsis">
      11. More Advanced Techniques in Asynchronous Programming
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. More Advanced Techniques in Asynchronous Programming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-priority-queues" class="md-nav__link">
    <span class="md-ellipsis">
      11.1. Priority Queues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-semaphores-and-locks" class="md-nav__link">
    <span class="md-ellipsis">
      11.2. Semaphores and Locks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113-async-streams" class="md-nav__link">
    <span class="md-ellipsis">
      11.3. Async Streams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-exception-propagation" class="md-nav__link">
    <span class="md-ellipsis">
      11.4. Exception Propagation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-using-tasks-effectively" class="md-nav__link">
    <span class="md-ellipsis">
      11.5. Using Tasks Effectively
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-combining-async-io-with-multiprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      12. Combining Async IO with Multiprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. Combining Async IO with Multiprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-basic-async-with-multiprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      12.1. Basic Async with Multiprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-asynchronous-process-communication" class="md-nav__link">
    <span class="md-ellipsis">
      12.2. Asynchronous Process Communication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-challenges-and-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      12.3. Challenges and Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-advanced-patterns-and-designs-in-async-applications" class="md-nav__link">
    <span class="md-ellipsis">
      13. Advanced Patterns and Designs in Async Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13. Advanced Patterns and Designs in Async Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-event-driven-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      13.1. Event-driven Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-service-actor-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      13.2. Service Actor Pattern
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-reactive-extensions-rxpy-with-async" class="md-nav__link">
    <span class="md-ellipsis">
      13.3. Reactive Extensions (RxPY with Async)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-debugging-and-profiling-asynchronous-python-applications" class="md-nav__link">
    <span class="md-ellipsis">
      14. Debugging and Profiling Asynchronous Python Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14. Debugging and Profiling Asynchronous Python Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-debug-mode-in-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      14.1. Debug Mode in asyncio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-logging-unclosed-resources" class="md-nav__link">
    <span class="md-ellipsis">
      14.2. Logging Unclosed Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-profiling-with-aio-profiler" class="md-nav__link">
    <span class="md-ellipsis">
      14.3. Profiling with aio-profiler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-debugging-with-ides" class="md-nav__link">
    <span class="md-ellipsis">
      14.4. Debugging with IDEs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#145-detecting-deadlocks" class="md-nav__link">
    <span class="md-ellipsis">
      14.5. Detecting Deadlocks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#146-monitoring-asynchronous-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      14.6. Monitoring Asynchronous Tasks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-scaling-and-deploying-asynchronous-applications" class="md-nav__link">
    <span class="md-ellipsis">
      15. Scaling and Deploying Asynchronous Applications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15. Scaling and Deploying Asynchronous Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151-event-loop-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      15.1. Event Loop Implementations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#152-load-balancing" class="md-nav__link">
    <span class="md-ellipsis">
      15.2. Load Balancing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#153-distributed-systems-and-microservices" class="md-nav__link">
    <span class="md-ellipsis">
      15.3. Distributed Systems and Microservices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#154-database-connections" class="md-nav__link">
    <span class="md-ellipsis">
      15.4. Database Connections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#155-memory-and-resource-leaks" class="md-nav__link">
    <span class="md-ellipsis">
      15.5. Memory and Resource Leaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#156-error-monitoring-and-alerting" class="md-nav__link">
    <span class="md-ellipsis">
      15.6. Error Monitoring and Alerting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#16-conclusion-and-continuous-learning-in-asynchronous-programming" class="md-nav__link">
    <span class="md-ellipsis">
      16. Conclusion and Continuous Learning in Asynchronous Programming
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-async-without-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      EXTRA async without asyncio
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>asyncio</h1>

<h3 id="1-introduction-to-asynchronous-programming">1. Introduction to Asynchronous Programming</h3>
<p>Asynchronous programming is a method that allows for the execution of certain tasks concurrently without blocking the main thread. Instead of waiting for one task to complete before moving on to the next, asynchronous programming allows multiple tasks to run in "parallel", making better use of system resources and often speeding up overall execution.</p>
<p><strong>Next topic:</strong> Traditional Multi-threading vs Asynchronous Programming.</p>
<h3 id="2-traditional-multi-threading-vs-asynchronous-programming">2. Traditional Multi-threading vs Asynchronous Programming</h3>
<p>In traditional multi-threading, multiple threads run in parallel. Each thread might be executing a different task or function. While this allows for concurrent execution, it also introduces complexity with thread management, synchronization, and potential deadlocks.</p>
<p>In contrast, asynchronous programming, especially in Python's context, utilizes a single-threaded event loop. Tasks are executed in this loop but can yield control back to the loop when waiting for some I/O operations, allowing other tasks to run.</p>
<p><strong>Advantages of Asynchronous Programming:</strong>
- <strong>Scalability:</strong> Asynchronous programs can handle many tasks with a single thread.
- <strong>Simplicity:</strong> Avoids complexities of thread synchronization and deadlocks.</p>
<p><strong>Next topic:</strong> Python's <code>asyncio</code> Basics.</p>
<h3 id="3-pythons-asyncio-basics">3. Python's <code>asyncio</code> Basics</h3>
<h4 id="31-async-await">3.1. <code>async</code> &amp; <code>await</code></h4>
<p>To mark a function as asynchronous, you use the <code>async</code> keyword before <code>def</code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">my_async_function</span><span class="p">():</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div></p>
<p>To call asynchronous functions or to execute asynchronous code inside an async function, you use the <code>await</code> keyword:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_data</span><span class="p">():</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_data_from_source</span><span class="p">()</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="32-event-loop">3.2. Event Loop</h4>
<p>The event loop is the heart of every asyncio application. It allows you to schedule asynchronous tasks and callbacks, run them, and manage their execution flow.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span>
<span class="normal"><a href="#__codelineno-2-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="33-tasks-and-coroutines">3.3. Tasks and Coroutines</h4>
<p>Tasks are used to schedule coroutines concurrently. A coroutine is a special type of function that can yield control back to the event loop, allowing other coroutines to run.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">say_hello</span><span class="p">():</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">say_world</span><span class="p">():</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;World&quot;</span><span class="p">)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="n">task1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">say_hello</span><span class="p">())</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>    <span class="n">task2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">say_world</span><span class="p">())</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>    <span class="k">await</span> <span class="n">task1</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>    <span class="k">await</span> <span class="n">task2</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p><strong>Next topic:</strong> Asynchronous I/O with Python.</p>
<h3 id="4-asynchronous-io-with-python">4. Asynchronous I/O with Python</h3>
<p>One of the primary uses for asynchronous programming is handling Input/Output (I/O) operations without blocking. I/O-bound tasks, such as network requests or reading and writing to databases, often involve waiting. Asynchronous I/O lets us perform these tasks more efficiently.</p>
<p>For instance, when fetching data from multiple URLs, instead of waiting for each request to complete one after another, you can fetch from multiple URLs "at the same time".</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">import</span> <span class="nn">aiohttp</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>            <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;http://example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;http://example.org&quot;</span><span class="p">,</span> <span class="s2">&quot;http://example.net&quot;</span><span class="p">]</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">fetch_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>    <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data from </span><span class="si">{</span><span class="n">url</span><span class="p">[:</span><span class="mi">30</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2"> characters&quot;</span><span class="p">)</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p><strong>Next topic:</strong> Advanced Techniques in Asynchronous Programming.</p>
<h3 id="5-advanced-techniques-in-asynchronous-programming">5. Advanced Techniques in Asynchronous Programming</h3>
<h4 id="51-managing-multiple-tasks-with-gather-wait">5.1. Managing Multiple Tasks with <code>gather</code> &amp; <code>wait</code></h4>
<p>We've already seen <code>gather</code> in action, which waits for all tasks to complete and returns their results. However, sometimes you might want to proceed as soon as one of the tasks completes, and for that, you can use <code>asyncio.wait</code> with the <code>FIRST_COMPLETED</code> option.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">task_one</span><span class="p">():</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>    <span class="k">return</span> <span class="s2">&quot;Task One Completed!&quot;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">task_two</span><span class="p">():</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>    <span class="k">return</span> <span class="s2">&quot;Task Two Completed!&quot;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">task_one</span><span class="p">(),</span> <span class="n">task_two</span><span class="p">()]</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>    <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a>    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="52-handling-timeouts-and-delays">5.2. Handling Timeouts and Delays</h4>
<p>Sometimes you might not want to wait indefinitely for a task to complete. Using <code>asyncio.wait_for</code>, you can set a timeout.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">long_task</span><span class="p">():</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">long_task</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Task took too long!&quot;</span><span class="p">)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="53-error-handling-in-async-context">5.3. Error Handling in Async Context</h4>
<p>Just like with synchronous code, you can use try-except blocks to handle errors in asynchronous functions.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">risky_task</span><span class="p">():</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This is an intentional error!&quot;</span><span class="p">)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>        <span class="k">await</span> <span class="n">risky_task</span><span class="p">()</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Caught an error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p><strong>Next topic:</strong> Integration with Other Libraries.</p>
<h3 id="6-integration-with-other-libraries">6. Integration with Other Libraries</h3>
<h4 id="61-aiohttp-for-asynchronous-http-requests">6.1. <code>aiohttp</code> for Asynchronous HTTP Requests</h4>
<p>We briefly touched on <code>aiohttp</code> earlier. It's a powerful library that provides asynchronous HTTP client and server functionality. The client lets you make non-blocking requests, while the server allows you to handle incoming requests asynchronously.</p>
<p>Example using <code>aiohttp</code> as a server:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span>
<span class="normal"><a href="#__codelineno-8-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="kn">import</span> <span class="n">web</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, world!&quot;</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="62-aiomysql-aiopg-for-asynchronous-database-operations">6.2. <code>aiomysql</code> &amp; <code>aiopg</code> for Asynchronous Database Operations</h4>
<p>For database operations, you can use libraries like <code>aiomysql</code> for MySQL and <code>aiopg</code> for PostgreSQL. These libraries provide asynchronous interfaces to interact with databases.</p>
<p>Example using <code>aiomysql</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kn">import</span> <span class="nn">aiomysql</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>    <span class="n">pool</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aiomysql</span><span class="o">.</span><span class="n">create_pool</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s1">&#39;testdb&#39;</span><span class="p">)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">pool</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>            <span class="k">await</span> <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT some_column FROM some_table;&quot;</span><span class="p">)</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>            <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">())</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>    <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a>    <span class="k">await</span> <span class="n">pool</span><span class="o">.</span><span class="n">wait_closed</span><span class="p">()</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p><strong>Next topic:</strong> Potential Pitfalls and Common Mistakes.</p>
<h3 id="7-potential-pitfalls-and-common-mistakes">7. Potential Pitfalls and Common Mistakes</h3>
<p>Understanding the potential pitfalls in asynchronous programming can save developers a lot of time and prevent unexpected behaviors.</p>
<h4 id="71-mixing-sync-and-async-code">7.1. Mixing Sync and Async Code</h4>
<p>One of the common mistakes is mixing synchronous code with asynchronous code without being aware of the consequences. For instance, using a blocking function inside an async function can halt the entire event loop.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span>
<span class="normal"><a href="#__codelineno-10-7">7</a></span>
<span class="normal"><a href="#__codelineno-10-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">wrong_usage</span><span class="p">():</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># This is a blocking call</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This will block the entire event loop&quot;</span><span class="p">)</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wrong_usage</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p>Always ensure that you're using non-blocking alternatives inside async functions.</p>
<h4 id="72-forgetting-await">7.2. Forgetting <code>await</code></h4>
<p>Another easy mistake is forgetting the <code>await</code> keyword when calling an async function. This results in the function not being executed, and instead, a coroutine object is returned.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span>
<span class="normal"><a href="#__codelineno-11-7">7</a></span>
<span class="normal"><a href="#__codelineno-11-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">greet</span><span class="p">():</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>    <span class="k">return</span> <span class="s2">&quot;Hello, World!&quot;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>    <span class="n">greeting</span> <span class="o">=</span> <span class="n">greet</span><span class="p">()</span>  <span class="c1"># Forgot await</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">greeting</span><span class="p">)</span>  <span class="c1"># This will print a coroutine object, not the greeting.</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="73-not-handling-exceptions-in-tasks">7.3. Not Handling Exceptions in Tasks</h4>
<p>If an exception is raised in a Task and not caught, it won't propagate immediately. Instead, it will propagate when the Task object is garbage collected, which can make debugging tricky.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">raise_error</span><span class="p">():</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Intentional Error&quot;</span><span class="p">)</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">raise_error</span><span class="p">())</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p>Always ensure you handle exceptions in your tasks, either within the task or when gathering/waiting for them.</p>
<p><strong>Next topic:</strong> Best Practices &amp; Recommendations.</p>
<h3 id="8-best-practices-recommendations">8. Best Practices &amp; Recommendations</h3>
<p>When writing asynchronous code, following best practices can help maintainability, performance, and overall code quality.</p>
<h4 id="81-use-async-and-await-consistently">8.1. Use <code>async</code> and <code>await</code> Consistently</h4>
<p>Ensure that you're consistently using the <code>async</code> and <code>await</code> keywords appropriately. If a function is asynchronous, mark it with <code>async</code> and ensure that its callers are aware that they're calling an async function.</p>
<h4 id="82-favor-high-level-apis">8.2. Favor High-Level APIs</h4>
<p>Python's <code>asyncio</code> provides both high-level and low-level APIs. Whenever possible, favor high-level APIs as they are more user-friendly and abstract away a lot of the complexity.</p>
<h4 id="83-use-asynchronous-context-managers">8.3. Use Asynchronous Context Managers</h4>
<p>Many async libraries provide asynchronous context managers, which help in ensuring that resources are properly managed. </p>
<p>For example, with <code>aiohttp</code>, you can use:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
<p>This ensures that the session is properly closed after usage.</p>
<h4 id="84-be-wary-of-thread-safety">8.4. Be Wary of Thread-Safety</h4>
<p>Even though asynchronous code in Python usually runs in a single thread, if you integrate with other systems or use thread pools, be aware of thread-safety. Ensure shared resources are accessed in a thread-safe manner.</p>
<p><strong>Next topic:</strong> Conclusion and Future of Python Async.</p>
<h3 id="9-conclusion-and-future-of-python-async">9. Conclusion and Future of Python Async</h3>
<p>Asynchronous programming in Python has come a long way, especially with the introduction and continuous development of <code>asyncio</code>. It provides a powerful toolset for writing efficient I/O-bound programs.</p>
<p>However, like all tools, it's essential to understand its strengths and limitations, and when to use it. Not all problems are best solved with asynchronicity, and sometimes, traditional multi-threading or even multi-processing can be more appropriate.</p>
<p>The future looks bright for async in Python, with continuous enhancements to <code>asyncio</code> and a growing ecosystem of asynchronous libraries. As the community gains more experience and the tooling improves, we can expect even more robust and performant asynchronous applications in Python.</p>
<p><strong>End of Topics.</strong></p>
<h3 id="10-advanced-queue-operations-with-asyncio">10. Advanced Queue Operations with <code>asyncio</code></h3>
<p><code>asyncio</code> provides a Queue class that is similar to <code>queue.Queue</code> but designed to be used with async functions.</p>
<h4 id="101-basic-queue-operations">10.1. Basic Queue Operations</h4>
<p>Queues are an essential part of many concurrent programs and can be used to pass messages between different parts of a system.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="n">queue</span><span class="p">):</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>        <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Produced </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">consumer</span><span class="p">(</span><span class="n">queue</span><span class="p">):</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>        <span class="n">item</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consumed </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="n">queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">producer</span><span class="p">(</span><span class="n">queue</span><span class="p">),</span> <span class="n">consumer</span><span class="p">(</span><span class="n">queue</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
<h4 id="102-implementing-producer-consumer-with-asyncio">10.2. Implementing Producer-Consumer with <code>asyncio</code></h4>
<p>The producer-consumer pattern is a classic concurrency pattern where one or more producers add tasks to a queue, and one or more consumers take tasks from the queue and process them.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>        <span class="n">item</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>        <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Producer </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> produced </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">consumer</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a>        <span class="n">item</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a>        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Sentinel value to exit</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a>            <span class="k">break</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consumer </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> consumed </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="n">queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="n">producers</span> <span class="o">=</span> <span class="p">[</span><span class="n">producer</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="n">consumers</span> <span class="o">=</span> <span class="p">[</span><span class="n">consumer</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="c1"># Run the producers and consumers</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">producers</span><span class="p">,</span> <span class="o">*</span><span class="n">consumers</span><span class="p">))</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="c1"># Signal the consumers to exit</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a>    <span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="103-limiting-queue-size">10.3. Limiting Queue Size</h4>
<p>For certain applications, you might want to limit the number of items a queue can hold. This can be useful to apply backpressure on the producer when the queue gets full.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="n">queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">bounded_producer</span><span class="p">(</span><span class="n">queue</span><span class="p">):</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Producing </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>        <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Produced </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bounded_producer</span><span class="p">(</span><span class="n">queue</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<p>When the queue reaches its maximum size, <code>queue.put</code> will block until there's room to add another item.</p>
<p><strong>Next topic:</strong> More Advanced Techniques in Asynchronous Programming.</p>
<h3 id="11-more-advanced-techniques-in-asynchronous-programming">11. More Advanced Techniques in Asynchronous Programming</h3>
<h4 id="111-priority-queues">11.1. Priority Queues</h4>
<p>You can use priority queues to ensure that some tasks get priority over others:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="kn">import</span> <span class="nn">heapq</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="k">class</span> <span class="nc">AsyncPriorityQueue</span><span class="p">:</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">priority</span><span class="p">):</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>        <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="p">,</span> <span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="p">:</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a>        <span class="n">priority</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="p">)</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a>        <span class="k">return</span> <span class="n">item</span>
</code></pre></div></td></tr></table></div>
<h4 id="112-semaphores-and-locks">11.2. Semaphores and Locks</h4>
<p>Semaphores and locks are synchronization primitives that can be used to protect resources:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="n">sem</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Allows 10 tasks to access a resource at a time</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">sem</span><span class="p">:</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2"> has started&quot;</span><span class="p">)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2"> has finished&quot;</span><span class="p">)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">worker</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">))))</span>
</code></pre></div></td></tr></table></div>
<h4 id="113-async-streams">11.3. Async Streams</h4>
<p>Async streams allow you to consume or produce multiple values with async iteration:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">ticker</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">to</span><span class="p">):</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">to</span><span class="p">):</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>        <span class="k">yield</span> <span class="n">i</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>    <span class="k">async</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ticker</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tick: </span><span class="si">{</span><span class="n">tick</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="114-exception-propagation">11.4. Exception Propagation</h4>
<p>When working with tasks, handling exceptions is crucial:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">raise_exception</span><span class="p">():</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An error occurred!&quot;</span><span class="p">)</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">raise_exception</span><span class="p">(),</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>    <span class="n">results</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">FIRST_EXCEPTION</span><span class="p">)</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a>            <span class="n">task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>  <span class="c1"># Will raise the ValueError</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Caught an error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="115-using-tasks-effectively">11.5. Using Tasks Effectively</h4>
<p>While creating tasks is simple, managing their lifecycle and ensuring they complete without hanging your application can be tricky:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">do_work</span><span class="p">():</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">do_work</span><span class="p">())</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Main work done!&quot;</span><span class="p">)</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>    <span class="k">await</span> <span class="n">task</span>  <span class="c1"># Ensure all spawned tasks are awaited</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p><strong>Next topic:</strong> Combining Async IO with Multiprocessing.</p>
<h3 id="12-combining-async-io-with-multiprocessing">12. Combining Async IO with Multiprocessing</h3>
<p>While <code>asyncio</code> excels at I/O-bound tasks, it runs in a single thread and doesn't utilize multiple cores for CPU-bound tasks. For these tasks, you can combine <code>asyncio</code> with multiprocessing to achieve parallelism across cores.</p>
<h4 id="121-basic-async-with-multiprocessing">12.1. Basic Async with Multiprocessing</h4>
<p>Here's a simple demonstration of running CPU-bound tasks in separate processes while using async for I/O:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="k">def</span> <span class="nf">cpu_bound_task</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>    <span class="c1"># Simulating a CPU-bound task by calculating sum</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a>    <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">cpu_bound_task</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">))</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="122-asynchronous-process-communication">12.2. Asynchronous Process Communication</h4>
<p>Communicate between processes using <code>asyncio</code> and <code>multiprocessing</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kn">import</span> <span class="nn">multiprocessing</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Produced </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">async_consumer</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>        <span class="n">item</span> <span class="o">=</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consumed </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="n">queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="n">process</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">queue</span><span class="p">,))</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="n">process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">async_consumer</span><span class="p">(</span><span class="n">queue</span><span class="p">))</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h4 id="123-challenges-and-considerations">12.3. Challenges and Considerations</h4>
<ul>
<li><strong>Error Handling:</strong> Ensure that exceptions in worker processes are properly propagated and handled.</li>
<li><strong>Data Serialization:</strong> Remember that data sent between processes needs to be serialized and deserialized, which can introduce overhead.</li>
<li><strong>Resource Management:</strong> Ensure all processes are cleaned up to avoid resource leaks or zombie processes.</li>
</ul>
<p><strong>Next topic:</strong> Advanced Patterns and Designs in Async Applications.</p>
<h3 id="13-advanced-patterns-and-designs-in-async-applications">13. Advanced Patterns and Designs in Async Applications</h3>
<h4 id="131-event-driven-architecture">13.1. Event-driven Architecture</h4>
<p>Using <code>asyncio</code>, you can build an event-driven system where components react to events rather than follow a strict sequential order:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span>
<span class="normal"><a href="#__codelineno-24-22">22</a></span>
<span class="normal"><a href="#__codelineno-24-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="k">class</span> <span class="nc">EventBus</span><span class="p">:</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>    <span class="k">def</span> <span class="nf">add_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">listener</span><span class="p">):</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a>        <span class="k">if</span> <span class="n">event</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span><span class="p">:</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a>        <span class="k">for</span> <span class="n">listener</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_listeners</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">[]):</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a>            <span class="k">await</span> <span class="n">listener</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">print_on_event</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received event with data: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="n">bus</span> <span class="o">=</span> <span class="n">EventBus</span><span class="p">()</span>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="n">bus</span><span class="o">.</span><span class="n">add_listener</span><span class="p">(</span><span class="s2">&quot;data_event&quot;</span><span class="p">,</span> <span class="n">print_on_event</span><span class="p">)</span>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a>    <span class="k">await</span> <span class="n">bus</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;data_event&quot;</span><span class="p">,</span> <span class="s2">&quot;Some event data&quot;</span><span class="p">)</span>
<a id="__codelineno-24-22" name="__codelineno-24-22"></a>
<a id="__codelineno-24-23" name="__codelineno-24-23"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="132-service-actor-pattern">13.2. Service Actor Pattern</h4>
<p>In an async world, actors can be lightweight services that hold state and provide methods to act on that state:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="k">class</span> <span class="nc">ServiceActor</span><span class="p">:</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State incremented to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">decrement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State decremented to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="n">actor</span> <span class="o">=</span> <span class="n">ServiceActor</span><span class="p">()</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a>    <span class="k">await</span> <span class="n">actor</span><span class="o">.</span><span class="n">increment</span><span class="p">()</span>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a>    <span class="k">await</span> <span class="n">actor</span><span class="o">.</span><span class="n">decrement</span><span class="p">()</span>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="133-reactive-extensions-rxpy-with-async">13.3. Reactive Extensions (RxPY with Async)</h4>
<p><code>RxPY</code> supports asynchronous operations and can be integrated with <code>asyncio</code> for reactive programming:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kn">import</span> <span class="nn">rx</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="kn">from</span> <span class="nn">rx.scheduler.eventloop</span> <span class="kn">import</span> <span class="n">AsyncIOScheduler</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">scheduler</span><span class="p">):</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="n">scheduler</span><span class="o">.</span><span class="n">loop</span><span class="p">)</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>    <span class="n">observer</span><span class="o">.</span><span class="n">on_next</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a>    <span class="n">observer</span><span class="o">.</span><span class="n">on_completed</span><span class="p">()</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="n">stream</span> <span class="o">=</span> <span class="n">rx</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="n">stream</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">on_next</span><span class="o">=</span><span class="nb">print</span><span class="p">,</span> <span class="n">scheduler</span><span class="o">=</span><span class="n">AsyncIOScheduler</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()))</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Next topic:</strong> Debugging and Profiling Asynchronous Python Applications.</p>
<h3 id="14-debugging-and-profiling-asynchronous-python-applications">14. Debugging and Profiling Asynchronous Python Applications</h3>
<p>Debugging and profiling asynchronous applications can be different than traditional synchronous applications. Let's look into techniques and tools available for <code>asyncio</code>:</p>
<h4 id="141-debug-mode-in-asyncio">14.1. Debug Mode in <code>asyncio</code></h4>
<p><code>asyncio</code> provides a debug mode that can help catch common mistakes:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span>
<span class="normal"><a href="#__codelineno-27-5">5</a></span>
<span class="normal"><a href="#__codelineno-27-6">6</a></span>
<span class="normal"><a href="#__codelineno-27-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">forgot_await</span><span class="p">():</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>    <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Missing `await`</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">set_debug</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">forgot_await</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p>In debug mode, the above will print a warning indicating that a coroutine has not been awaited.</p>
<h4 id="142-logging-unclosed-resources">14.2. Logging Unclosed Resources</h4>
<p>To help debug issues related to unclosed resources like sockets, you can enable logging:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kn">import</span> <span class="nn">logging</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>This will print detailed debug information about resources that were not closed properly.</p>
<h4 id="143-profiling-with-aio-profiler">14.3. Profiling with <code>aio-profiler</code></h4>
<p><code>aio-profiler</code> is a tool specifically designed to profile asynchronous Python applications:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a>pip<span class="w"> </span>install<span class="w"> </span>aio-profiler
</code></pre></div></td></tr></table></div>
<p>Using <code>aio-profiler</code>, you can visualize where your asynchronous application spends its time, helping optimize performance-critical sections.</p>
<h4 id="144-debugging-with-ides">14.4. Debugging with IDEs</h4>
<p>Modern IDEs, like PyCharm, have support for debugging asynchronous Python code. You can set breakpoints, inspect variable values, and step through async code just like synchronous code.</p>
<h4 id="145-detecting-deadlocks">14.5. Detecting Deadlocks</h4>
<p>If your asynchronous code appears to hang, it could be due to a deadlock. This often happens when tasks are waiting for each other in a cycle. In such cases, tools like <code>aio-deadlock-detector</code> can help identify and break such cycles.</p>
<h4 id="146-monitoring-asynchronous-tasks">14.6. Monitoring Asynchronous Tasks</h4>
<p>Using the <code>asyncio.all_tasks()</code> function, you can monitor all running tasks. This can be useful to ensure no tasks are left dangling:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">example_task</span><span class="p">():</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a>    <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">example_task</span><span class="p">())</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running tasks:&quot;</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">all_tasks</span><span class="p">())</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p><strong>Next topic:</strong> Scaling and Deploying Asynchronous Applications.</p>
<h3 id="15-scaling-and-deploying-asynchronous-applications">15. Scaling and Deploying Asynchronous Applications</h3>
<p>Once your asynchronous application is developed and tested, the next step is to deploy and scale it. Here are some strategies and considerations:</p>
<h4 id="151-event-loop-implementations">15.1. Event Loop Implementations</h4>
<p>While the default event loop in <code>asyncio</code> is sufficient for most tasks, there are alternative implementations like <code>uvloop</code> which can offer better performance:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a>pip<span class="w"> </span>install<span class="w"> </span>uvloop
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kn">import</span> <span class="nn">asyncio</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="kn">import</span> <span class="nn">uvloop</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop_policy</span><span class="p">(</span><span class="n">uvloop</span><span class="o">.</span><span class="n">EventLoopPolicy</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="152-load-balancing">15.2. Load Balancing</h4>
<p>Just like synchronous applications, asynchronous applications can benefit from load balancing to distribute incoming traffic among multiple instances of the application. Common load balancers like NGINX or HAProxy can be used.</p>
<h4 id="153-distributed-systems-and-microservices">15.3. Distributed Systems and Microservices</h4>
<p>When scaling applications, consider breaking them into microservices. Asynchronous communication can be established between services using message queues like RabbitMQ or Kafka.</p>
<h4 id="154-database-connections">15.4. Database Connections</h4>
<p>When using asynchronous databases, be aware of connection limits. Use connection pooling and avoid holding onto connections longer than necessary.</p>
<h4 id="155-memory-and-resource-leaks">15.5. Memory and Resource Leaks</h4>
<p>Asynchronous applications, especially long-running ones, should be monitored for memory and resource leaks. Tools like <code>objgraph</code> or built-in Python profilers can help identify and fix such leaks.</p>
<h4 id="156-error-monitoring-and-alerting">15.6. Error Monitoring and Alerting</h4>
<p>Implement monitoring and alerting to keep an eye on exceptions and errors in production. Tools like Sentry can be integrated to capture and notify about runtime errors.</p>
<p><strong>Next topic:</strong> Conclusion and Continuous Learning in Asynchronous Programming.</p>
<h3 id="16-conclusion-and-continuous-learning-in-asynchronous-programming">16. Conclusion and Continuous Learning in Asynchronous Programming</h3>
<p>The landscape of asynchronous programming in Python is vast and continuously evolving. With tools like <code>asyncio</code> and the expanding ecosystem around it, developers have powerful mechanisms to write efficient, scalable, and maintainable applications.</p>
<p>However, the journey doesn't end with mastering <code>asyncio</code> or any specific library. The Python community is vibrant and always innovating. It's essential to stay updated, participate in discussions, and continuously experiment with new techniques, tools, and best practices.</p>
<p>Asynchronous programming, once an advanced topic, is slowly becoming a core skill for Python developers. Embrace the paradigm, understand its intricacies, and leverage it to build the next generation of responsive and performant Python applications.</p>
<p><strong>End of Topics.</strong></p>
<h2 id="extra-async-without-asyncio">EXTRA async without asyncio</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span>
<span class="normal"><a href="#__codelineno-33-17">17</a></span>
<span class="normal"><a href="#__codelineno-33-18">18</a></span>
<span class="normal"><a href="#__codelineno-33-19">19</a></span>
<span class="normal"><a href="#__codelineno-33-20">20</a></span>
<span class="normal"><a href="#__codelineno-33-21">21</a></span>
<span class="normal"><a href="#__codelineno-33-22">22</a></span>
<span class="normal"><a href="#__codelineno-33-23">23</a></span>
<span class="normal"><a href="#__codelineno-33-24">24</a></span>
<span class="normal"><a href="#__codelineno-33-25">25</a></span>
<span class="normal"><a href="#__codelineno-33-26">26</a></span>
<span class="normal"><a href="#__codelineno-33-27">27</a></span>
<span class="normal"><a href="#__codelineno-33-28">28</a></span>
<span class="normal"><a href="#__codelineno-33-29">29</a></span>
<span class="normal"><a href="#__codelineno-33-30">30</a></span>
<span class="normal"><a href="#__codelineno-33-31">31</a></span>
<span class="normal"><a href="#__codelineno-33-32">32</a></span>
<span class="normal"><a href="#__codelineno-33-33">33</a></span>
<span class="normal"><a href="#__codelineno-33-34">34</a></span>
<span class="normal"><a href="#__codelineno-33-35">35</a></span>
<span class="normal"><a href="#__codelineno-33-36">36</a></span>
<span class="normal"><a href="#__codelineno-33-37">37</a></span>
<span class="normal"><a href="#__codelineno-33-38">38</a></span>
<span class="normal"><a href="#__codelineno-33-39">39</a></span>
<span class="normal"><a href="#__codelineno-33-40">40</a></span>
<span class="normal"><a href="#__codelineno-33-41">41</a></span>
<span class="normal"><a href="#__codelineno-33-42">42</a></span>
<span class="normal"><a href="#__codelineno-33-43">43</a></span>
<span class="normal"><a href="#__codelineno-33-44">44</a></span>
<span class="normal"><a href="#__codelineno-33-45">45</a></span>
<span class="normal"><a href="#__codelineno-33-46">46</a></span>
<span class="normal"><a href="#__codelineno-33-47">47</a></span>
<span class="normal"><a href="#__codelineno-33-48">48</a></span>
<span class="normal"><a href="#__codelineno-33-49">49</a></span>
<span class="normal"><a href="#__codelineno-33-50">50</a></span>
<span class="normal"><a href="#__codelineno-33-51">51</a></span>
<span class="normal"><a href="#__codelineno-33-52">52</a></span>
<span class="normal"><a href="#__codelineno-33-53">53</a></span>
<span class="normal"><a href="#__codelineno-33-54">54</a></span>
<span class="normal"><a href="#__codelineno-33-55">55</a></span>
<span class="normal"><a href="#__codelineno-33-56">56</a></span>
<span class="normal"><a href="#__codelineno-33-57">57</a></span>
<span class="normal"><a href="#__codelineno-33-58">58</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="k">class</span> <span class="nc">Task</span><span class="p">:</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gen</span><span class="p">):</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gen</span> <span class="o">=</span> <span class="n">gen</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_wake_up_time</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a>        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wake_up_time</span><span class="p">:</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a>            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gen</span><span class="p">)</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a>        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a>
<a id="__codelineno-33-17" name="__codelineno-33-17"></a>    <span class="k">def</span> <span class="nf">set_wake_up_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_wake_up_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">delay</span>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a>
<a id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="k">class</span> <span class="nc">Scheduler</span><span class="p">:</span>
<a id="__codelineno-33-21" name="__codelineno-33-21"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-33-22" name="__codelineno-33-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-33-23" name="__codelineno-33-23"></a>
<a id="__codelineno-33-24" name="__codelineno-33-24"></a>    <span class="k">def</span> <span class="nf">add_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_gen</span><span class="p">):</span>
<a id="__codelineno-33-25" name="__codelineno-33-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Task</span><span class="p">(</span><span class="n">task_gen</span><span class="p">))</span>
<a id="__codelineno-33-26" name="__codelineno-33-26"></a>
<a id="__codelineno-33-27" name="__codelineno-33-27"></a>    <span class="k">def</span> <span class="nf">sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_task</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
<a id="__codelineno-33-28" name="__codelineno-33-28"></a>        <span class="n">current_task</span><span class="o">.</span><span class="n">set_wake_up_time</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
<a id="__codelineno-33-29" name="__codelineno-33-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_task</span><span class="p">)</span>
<a id="__codelineno-33-30" name="__codelineno-33-30"></a>
<a id="__codelineno-33-31" name="__codelineno-33-31"></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-33-32" name="__codelineno-33-32"></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="p">:</span>
<a id="__codelineno-33-33" name="__codelineno-33-33"></a>            <span class="n">current_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-33-34" name="__codelineno-33-34"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">current_task</span><span class="o">.</span><span class="n">run</span><span class="p">():</span>
<a id="__codelineno-33-35" name="__codelineno-33-35"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_task</span><span class="p">)</span>
<a id="__codelineno-33-36" name="__codelineno-33-36"></a>
<a id="__codelineno-33-37" name="__codelineno-33-37"></a><span class="c1"># Global scheduler instance</span>
<a id="__codelineno-33-38" name="__codelineno-33-38"></a><span class="n">scheduler</span> <span class="o">=</span> <span class="n">Scheduler</span><span class="p">()</span>
<a id="__codelineno-33-39" name="__codelineno-33-39"></a>
<a id="__codelineno-33-40" name="__codelineno-33-40"></a><span class="k">def</span> <span class="nf">async_sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">):</span>
<a id="__codelineno-33-41" name="__codelineno-33-41"></a>    <span class="k">yield</span>
<a id="__codelineno-33-42" name="__codelineno-33-42"></a>    <span class="n">scheduler</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">current_task</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>
<a id="__codelineno-33-43" name="__codelineno-33-43"></a>    <span class="k">yield</span>
<a id="__codelineno-33-44" name="__codelineno-33-44"></a>
<a id="__codelineno-33-45" name="__codelineno-33-45"></a><span class="k">def</span> <span class="nf">coro1</span><span class="p">():</span>
<a id="__codelineno-33-46" name="__codelineno-33-46"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coroutine 1: Start&quot;</span><span class="p">)</span>
<a id="__codelineno-33-47" name="__codelineno-33-47"></a>    <span class="k">yield from</span> <span class="n">async_sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-33-48" name="__codelineno-33-48"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coroutine 1: After 2 seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-33-49" name="__codelineno-33-49"></a>
<a id="__codelineno-33-50" name="__codelineno-33-50"></a><span class="k">def</span> <span class="nf">coro2</span><span class="p">():</span>
<a id="__codelineno-33-51" name="__codelineno-33-51"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coroutine 2: Start&quot;</span><span class="p">)</span>
<a id="__codelineno-33-52" name="__codelineno-33-52"></a>    <span class="k">yield from</span> <span class="n">async_sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-33-53" name="__codelineno-33-53"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coroutine 2: After 1 second&quot;</span><span class="p">)</span>
<a id="__codelineno-33-54" name="__codelineno-33-54"></a>
<a id="__codelineno-33-55" name="__codelineno-33-55"></a><span class="c1"># Add coroutines to the scheduler and run them</span>
<a id="__codelineno-33-56" name="__codelineno-33-56"></a><span class="n">scheduler</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">coro1</span><span class="p">())</span>
<a id="__codelineno-33-57" name="__codelineno-33-57"></a><span class="n">scheduler</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">coro2</span><span class="p">())</span>
<a id="__codelineno-33-58" name="__codelineno-33-58"></a><span class="n">scheduler</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>